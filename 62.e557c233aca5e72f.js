"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[62],{46062:(z,h,r)=>{r.r(h),r.d(h,{ProtocolFeeModule:()=>U});var d=r(69808),g=r(91083),u=r(17489),x=r(28321),f=r(11730),t=r(5e3),v=r(53405),P=r(74696),F=r(31657),Z=r(92134),y=r(11523),m=r(4834),p=r(26688),A=r(75303);function O(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t.TgZ(3,"span",14),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&e){const o=a.$implicit,i=a.index,s=t.oxw();t.xp6(2),t.hij("",o,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,s.currentProtocolFeeRatio[i],4),"")}}const C=[{path:"",component:(()=>{class e{constructor(o,i,s,n){this.graphService=o,this.echartService=i,this.web3Service=s,this.refreshService=n,this.option1={},this.option2={},this.reserveNames=[],this.totalProtocolFee=0,this.currentProtocolFeeRatio=[],this.dailyProtocolFeeValue=[]}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchReserves(),this.fetchOptions()]).then(()=>{this.buildOption()})}buildOption(){this.option1.series=Array(this.reserveNames.length).fill(null).map((o,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyProtocolFeeValue[i]})),this.option2.series[0].data=Array(this.reserveNames.length).fill(null).map((o,i)=>({name:this.reserveNames[i],value:this.currentProtocolFeeRatio[i]})),this.option1=(0,u.cloneDeep)(this.option1),this.option2=(0,u.cloneDeep)(this.option2)}fetchOptions(){return Promise.all([this.echartService.fetchOption("TiUSD-Reserve-Bar"),this.echartService.fetchOption("TiUSD-Reserve-Pie")]).then(o=>{this.option1=o[0],this.option2=o[1]})}fetchReserves(){return this.graphService.fetchAllSwapPairDailyData().then(({data:o})=>{const i=o.pairs;this.reserveNames=[],i.forEach(s=>{this.reserveNames.push(s.token1.symbol)})}).then(()=>this.fetchProtocolFee())}fetchProtocolFee(){return this.graphService.fetchVaultFund(f.wE.ProtocolFeeVault.toLowerCase()).then(({data:o})=>{const i=o.fundVault?o.fundVault.dailyBalance:[];this.dailyProtocolFeeValue=Array(this.reserveNames.length).fill(Array(30).fill(null));const s=(0,x.Gq)().reverse();i.forEach(n=>{const l=s.indexOf(1e3*n.dayStartTimestamp),c=this.reserveNames.indexOf(n.token.symbol);-1!==l&&-1!==c&&(this.dailyProtocolFeeValue[c][l]=n.balance/n.token.decimals)}),this.dailyProtocolFeeValue.forEach(n=>{let l=0;n.forEach((c,S)=>{null===c?n[S]=l:l=c})}),this.totalProtocolFee=0,this.currentProtocolFeeRatio=this.dailyProtocolFeeValue.map(n=>(this.totalProtocolFee+=n[n.length-1],n[n.length-1]))})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(v.h),t.Y36(P.p),t.Y36(f.Uc),t.Y36(F.g))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-protocol-fee"]],decls:30,vars:7,consts:[[1,"protocol-fee-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],[1,"value"],["text","xxxxxxxxxxxxxxxxxxxxx"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[4,"ngFor","ngForOf"],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","2fr 3fr 2fr","align-items","center"],[2,"justify-self","center"],[1,"pool-chart"],[2,"justify-self","start"],[2,"justify-self","end"]],template:function(o,i){1&o&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"Protocol Fee Accumulation"),t.qZA(),t.TgZ(4,"span",3),t._uU(5,"$1,000,000.00"),t.qZA(),t.qZA(),t.TgZ(6,"div",1),t.TgZ(7,"h2",2),t._uU(8,"Distributed Protocol Fee"),t._UZ(9,"titi-tooltip",4),t.qZA(),t.TgZ(10,"span",3),t._uU(11,"$10,000,000.00"),t.qZA(),t.qZA(),t.TgZ(12,"div",5),t._UZ(13,"titi-chart-wrapper",6),t.qZA(),t.TgZ(14,"div",7),t.TgZ(15,"h2",8),t._uU(16,"Protocol Fee Vault"),t._UZ(17,"titi-tooltip",4),t.qZA(),t.TgZ(18,"h2",8),t._uU(19),t.ALo(20,"numberFormat"),t.qZA(),t.YNc(21,O,6,5,"ng-container",9),t.TgZ(22,"div",10),t._UZ(23,"mat-divider"),t.TgZ(24,"mat-chip-list",11),t.TgZ(25,"mat-chip"),t._uU(26,"Ratio"),t.qZA(),t.qZA(),t._UZ(27,"mat-divider"),t.qZA(),t.TgZ(28,"div",12),t._UZ(29,"titi-chart-wrapper",6),t.qZA(),t.qZA(),t.qZA()),2&o&&(t.xp6(13),t.Q6J("option",i.option1),t.xp6(6),t.hij("$",t.xi3(20,4,i.totalProtocolFee,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option2))},directives:[Z.Q,y.o,d.sg,m.d,p.qn,p.HS],pipes:[A.p],styles:[".protocol-fee-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 3;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;margin-left:48px;align-self:end;font-size:18px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 4;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:100%;min-height:350px}.pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:40px 40px 40px 40px auto;grid-row-gap:12px;row-gap:12px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;height:40px;justify-self:center;align-self:start}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;width:100%;height:100%;justify-self:center}@media screen and (max-width: 1024px){.protocol-fee-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px;box-sizing:border-box}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 36px}.chart-wrapper[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px;height:auto}}"]}),e})()}];let M=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[g.Bz.forChild(C)],g.Bz]}),e})();var T=r(45922),w=r(87841);let U=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.ez,M,m.t,p.Hi,T.F,w.m]]}),e})()}}]);