"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[308],{57308:(U,h,a)=>{a.r(h),a.d(h,{TitiModule:()=>Z});var f=a(69808),T=a(91083),u=a(17489),d=a(28321),g=a(11730),t=a(5e3),m=a(53405),v=a(74696),y=a(31657),D=a(92134),S=a(11523),P=a(75303);const C=[{path:"",component:(()=>{class n{constructor(i,e,r,o){this.graphService=i,this.echartService=e,this.web3Service=r,this.refreshService=o,this.totalStakedTiTi=0,this.totalTiTiSupply=0,this.titiDailyPrice=[],this.TiUSDDailyPrice=[],this.option={}}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchTiUSDChartData(),this.fetchCurrentEpochInfo(),this.fetchTiTiTotalSupply(),this.fetchOptions()]).then(()=>this.buildOption())}buildOption(){this.option.series[0].data=this.titiDailyPrice,this.option=(0,u.cloneDeep)(this.option)}fetchOptions(){return this.echartService.fetchOption("TiTi-Price").then(i=>this.option=i)}fetchTiUSDChartData(){return this.graphService.fetchMMFSwapPairDailyData(g.wE.MAMMSwapPair).then(({data:i})=>{this.TiUSDDailyPrice=Array(30).fill(null);const e=(0,d.Gq)().reverse();i.pair.pairDailyData.forEach(o=>{const s=e.indexOf(1e3*o.dayStartTimestamp);-1!==s&&(this.TiUSDDailyPrice[s]=o.token0Price)});let r=1;return this.TiUSDDailyPrice.forEach((o,s)=>{null==o?this.TiUSDDailyPrice[s]=r:r=o}),this.fetchUniwapPairDailyData()})}fetchUniwapPairDailyData(){return Promise.all([this.graphService.fetchUniwapPairDailyData(),this.web3Service.invokeContract("UniswapV2Pair","getReserves",[])]).then(([{data:i},e])=>{const r=Array(30).fill(null),o=(0,d.Gq)().reverse();0===i.uniswapPair.dailyData.length?r.fill(e[1]/e[0]):i.uniswapPair.dailyData.forEach(l=>{const p=o.indexOf(1e3*l.dayStartTimestamp);-1!==p&&(r[p]=l.fund1/l.fund0)});let s="0";r.forEach((l,p)=>{null==l?r[p]=s/this.TiUSDDailyPrice[p]:(r[p]=l/this.TiUSDDailyPrice[p],s=r[p])}),this.titiDailyPrice=r})}fetchCurrentEpochInfo(){return this.web3Service.invokeContract("TiTiBackendV1","epochNum",[]).then(i=>{this.fetchTiTiStakingInfoByEpoch(i[0])})}fetchTiTiStakingInfoByEpoch(i){return this.graphService.fetchTiTiStakingDailyData().then(({data:e})=>{this.totalStakedTiTi=e.tiTiStakingEpochDailyDatas[0]?e.tiTiStakingEpochDailyDatas[0].tvl:0})}fetchTiTiTotalSupply(){return this.web3Service.invokeContract("TiTiToken","totalSupply",[]).then(i=>{this.totalTiTiSupply=i[0]/10**18})}}return n.\u0275fac=function(i){return new(i||n)(t.Y36(m.h),t.Y36(v.p),t.Y36(g.Uc),t.Y36(y.g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-titi"]],decls:23,vars:14,consts:[[1,"titi-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","TiTi price calculated based on Uniswap and MAMM"],[1,"value"],["text","Proportion of staked TiTi in total circulation"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option","showTitle"]],template:function(i,e){1&i&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiTi Price "),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(8,"div",1),t.TgZ(9,"h2",2),t._uU(10,"TiTi Circulation"),t.qZA(),t.TgZ(11,"span",4),t._uU(12),t.ALo(13,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(14,"div",1),t.TgZ(15,"h2",2),t._uU(16,"Staked Ratio "),t._UZ(17,"titi-tooltip",5),t.qZA(),t.TgZ(18,"span",4),t._uU(19),t.ALo(20,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(21,"div",6),t._UZ(22,"titi-chart-wrapper",7),t.qZA(),t.qZA()),2&i&&(t.xp6(6),t.hij("$",t.xi3(7,5,e.titiDailyPrice[e.titiDailyPrice.length-1],4),""),t.xp6(6),t.Oqu(t.xi3(13,8,e.totalTiTiSupply,4)),t.xp6(7),t.hij("",0===e.totalTiTiSupply?0:t.xi3(20,11,100*e.totalStakedTiTi/e.totalTiTiSupply,4),"%"),t.xp6(3),t.Q6J("option",e.option)("showTitle",!0))},directives:[D.Q,S.o],pipes:[P.p],styles:[".titi-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:end;font-size:18px;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 6;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:calc(100vh - 280px)}@media screen and (max-width: 1024px){.titi-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px;height:auto}}"]}),n})()}];let M=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[T.Bz.forChild(C)],T.Bz]}),n})();var w=a(45922),x=a(87841);let Z=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[f.ez,M,w.F,x.m]]}),n})()}}]);