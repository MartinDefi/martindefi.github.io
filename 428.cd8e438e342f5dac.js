"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[428],{38428:(j,m,a)=>{a.r(m),a.d(m,{TiusdModule:()=>M});var f=a(69808),v=a(91083),d=a(17489),y=a(28321),u=a(11730),t=a(5e3),Z=a(53405),T=a(74696),R=a(31657),A=a(92134),U=a(11523),x=a(4834),g=a(26688),F=a(75303);function S(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t.TgZ(3,"span",14),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&n){const e=o.$implicit,i=o.index,s=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,s.currentReserveRatio[i],4),"")}}function C(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"span",13),t._uU(2),t.qZA(),t.TgZ(3,"span",14),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&n){const e=o.$implicit,i=o.index,s=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,s.currentRainydayFundRatio[i],4),"")}}const O=[{path:"",component:(()=>{class n{constructor(e,i,s,r){this.graphService=e,this.echartService=i,this.web3Service=s,this.refreshService=r,this.option1={},this.option2={},this.option3={},this.option4={},this.TiUSDCirculation=0,this.TiUSDPrice=1,this.reserveRatio=0,this.totalReserve=0,this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalRainydayFund=0,this.currentRainydayFundRatio=[],this.dailyRainydayFundValue=[]}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchReserves(),this.fetchOptions()]).then(()=>{this.buildOption(),this.fetchTiUSDInfo()})}buildOption(){this.option1.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyReserveValue[i]})),this.option3.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyRainydayFundValue[i]})),this.option2.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentReserveRatio[i]})),this.option4.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentRainydayFundRatio[i]})),this.option1=(0,d.cloneDeep)(this.option1),this.option2=(0,d.cloneDeep)(this.option2),this.option3=(0,d.cloneDeep)(this.option3),this.option4=(0,d.cloneDeep)(this.option4)}fetchOptions(){return Promise.all([this.echartService.fetchOption("TiUSD-Reserve-Bar"),this.echartService.fetchOption("TiUSD-Reserve-Pie"),this.echartService.fetchOption("RainydayFund-Bar"),this.echartService.fetchOption("RainydayFund-Pie")]).then(e=>{this.option1=e[0],this.option2=e[1],this.option3=e[2],this.option4=e[3]})}fetchReserves(){return this.graphService.fetchAllSwapPairDailyData().then(({data:e})=>{const i=e.pairs;this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalReserve=0,i.forEach(s=>{this.reserveNames.push(s.token1.symbol),this.currentReserveRatio.push(s.fund1/s.token1.decimals),this.totalReserve+=s.fund1/s.token1.decimals;const r=Array(30).fill(null),p=(0,y.Gq)().reverse();s.pairDailyData.forEach(h=>{const c=p.indexOf(1e3*h.dayStartTimestamp);-1!==c&&(r[c]=h.fund1/s.token1.decimals)});let l=0;r.forEach((h,c)=>{null===h?r[c]=l:l=h}),this.dailyReserveValue.push(r)})}).then(()=>this.fetchRainydayFund())}fetchRainydayFund(){return this.graphService.fetchVaultFund(u.wE.RainyDayFundVault.toLowerCase()).then(({data:e})=>{const i=e.fundVault?e.fundVault.dailyBalance:[];this.dailyRainydayFundValue=Array(this.reserveNames.length).fill(Array(30).fill(null));const s=(0,y.Gq)().reverse();i.forEach(r=>{const p=s.indexOf(1e3*r.dayStartTimestamp),l=this.reserveNames.indexOf(r.token.symbol);-1!==p&&-1!==l&&(this.dailyRainydayFundValue[l][p]=r.balance/r.token.decimals)}),this.dailyRainydayFundValue.forEach(r=>{let p=0;r.forEach((l,h)=>{null===l?r[h]=p:p=l})}),this.totalRainydayFund=0,this.currentRainydayFundRatio=this.dailyRainydayFundValue.map(r=>(this.totalRainydayFund+=r[r.length-1],r[r.length-1]))})}fetchTiUSDInfo(){Promise.all([this.web3Service.invokeContract("TiUSDToken","totalSupply",[]),this.web3Service.invokeContract("TiUSDToken","balanceOf",[u.wE.MAMMSwapPair])]).then(([e,i])=>{this.TiUSDCirculation=e[0]/10**18-i[0]/10**18,this.TiUSDPrice=this.totalReserve*10**18/i[0],this.reserveRatio=100*this.totalReserve/(this.TiUSDCirculation*this.TiUSDPrice)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.h),t.Y36(T.p),t.Y36(u.Uc),t.Y36(R.g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tiusd"]],decls:57,vars:26,consts:[[1,"tisud-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],[1,"value"],["text","xxxxxxxxxxxxxxxxxxxxx"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[4,"ngFor","ngForOf"],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","2fr 3fr 2fr","align-items","center"],[2,"justify-self","center"],[1,"pool-chart"],[2,"justify-self","start"],[2,"justify-self","end"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiUSD Price"),t.qZA(),t.TgZ(4,"span",3),t._uU(5),t.ALo(6,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(7,"div",1),t.TgZ(8,"h2",2),t._uU(9,"TiUSD Circulation"),t._UZ(10,"titi-tooltip",4),t.qZA(),t.TgZ(11,"span",3),t._uU(12),t.ALo(13,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(14,"div",1),t.TgZ(15,"h2",2),t._uU(16,"Reserve Ratio"),t._UZ(17,"titi-tooltip",4),t.qZA(),t.TgZ(18,"span",3),t._uU(19),t.ALo(20,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(21,"div",5),t._UZ(22,"titi-chart-wrapper",6),t.qZA(),t.TgZ(23,"div",7),t.TgZ(24,"h2",8),t._uU(25,"Total Reserve Value"),t._UZ(26,"titi-tooltip",4),t.qZA(),t.TgZ(27,"h2",8),t._uU(28),t.ALo(29,"numberFormat"),t.qZA(),t.YNc(30,S,6,5,"ng-container",9),t.TgZ(31,"div",10),t._UZ(32,"mat-divider"),t.TgZ(33,"mat-chip-list",11),t.TgZ(34,"mat-chip"),t._uU(35,"Reserve Ratio"),t.qZA(),t.qZA(),t._UZ(36,"mat-divider"),t.qZA(),t.TgZ(37,"div",12),t._UZ(38,"titi-chart-wrapper",6),t.qZA(),t.qZA(),t.TgZ(39,"div",5),t._UZ(40,"titi-chart-wrapper",6),t.qZA(),t.TgZ(41,"div",7),t.TgZ(42,"h2",8),t._uU(43,"Rainy Day Fund"),t._UZ(44,"titi-tooltip",4),t.qZA(),t.TgZ(45,"h2",8),t._uU(46),t.ALo(47,"numberFormat"),t.qZA(),t.YNc(48,C,6,5,"ng-container",9),t.TgZ(49,"div",10),t._UZ(50,"mat-divider"),t.TgZ(51,"mat-chip-list",11),t.TgZ(52,"mat-chip"),t._uU(53,"Ratio"),t.qZA(),t.qZA(),t._UZ(54,"mat-divider"),t.qZA(),t.TgZ(55,"div",12),t._UZ(56,"titi-chart-wrapper",6),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(5),t.hij("$ ",t.xi3(6,11,i.TiUSDPrice,4),""),t.xp6(7),t.Oqu(t.xi3(13,14,i.TiUSDCirculation,4)),t.xp6(7),t.hij("",t.xi3(20,17,i.reserveRatio,4),"%"),t.xp6(3),t.Q6J("option",i.option1),t.xp6(6),t.hij("$ ",t.xi3(29,20,i.totalReserve,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option2),t.xp6(2),t.Q6J("option",i.option3),t.xp6(6),t.hij("$ ",t.xi3(47,23,i.totalRainydayFund,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option4))},directives:[A.Q,U.o,f.sg,x.d,g.qn,g.HS],pipes:[F.p],styles:[".tisud-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;margin-left:48px;align-self:end;font-size:18px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 4;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:100%}.pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:40px 40px 40px auto;grid-row-gap:12px;row-gap:12px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;height:40px;justify-self:center;align-self:start}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;justify-self:center;width:100%;height:100%}@media screen and (max-width: 1024px){.tisud-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px}.chart-wrapper[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px;height:auto}}"]}),n})()}];let D=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[v.Bz.forChild(O)],v.Bz]}),n})();var P=a(45922),w=a(87841);let M=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[f.ez,D,x.t,g.Hi,P.F,w.m]]}),n})()}}]);