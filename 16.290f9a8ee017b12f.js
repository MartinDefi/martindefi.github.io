"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[16],{39016:(J,w,a)=>{a.r(w),a.d(w,{MmfModule:()=>E});var P=a(69808),m=a(93075),Z=a(91083),p=a(11730),f=a(24102),y=a(98538),h=a.n(y),u=a(28321),D=a(17489),t=a(5e3),b=a(94602),g=a(68326),U=a(22313),x=a(53405),F=a(74696),I=a(31657),V=a(48966),R=a(92134),d=a(67322),S=a(77531),k=a(47423),A=a(4834),T=a(26688),L=a(11523),O=a(75303);const C=[{token0:"TiUSD",token1:"USDC"}],j=[{path:"",component:(()=>{class o{constructor(e,i,n,r,s,l,M,v){this.accountService=e,this.web3Service=i,this.graphService=s,this.echartService=l,this.refreshService=M,this.dialog=v,this.MMFPairList=C,this.currentMMFPair=C[0],this.mTokenBalance=0,this.claimableValue=0,this.decimal0=18,this.decimal1=6,this.totalStakedLPToken=0,this.stakedLPTokenBalance=0,this.token1Balance=0,this.stakingInputValue="0.0000",this.withdrawInputValue="0.0000",this.claimInputValue="0.0000",this.titiDailyPrice=[],this.mmfRewardDailyData=[],this.mmfTotalReward=0,this.mmfRewardIn24H=0,this.distributedTiTiRewards=0,this.rewardRate=0,this.epochNum=0,this.startTime=0,this.periodFinish=0,this.token1DailyData=[],this.historicalAPY=[],this.option={},n.addSvgIconLiteral("USDC",r.bypassSecurityTrustHtml(f.WZ)),n.addSvgIconLiteral("TiUSD",r.bypassSecurityTrustHtml(f.Mg)),n.addSvgIconLiteral("TiTi",r.bypassSecurityTrustHtml(f.FZ))}calcHistoricalAPY(){this.mmfTotalReward=0;const e=Array(30).fill(null),i=(0,u.Gq)().reverse();i.forEach((n,r)=>e[r]=this.token1DailyData[r].fund1>0?this.titiDailyPrice[r]*this.rewardRate*86400*365*10**this.decimal1/(this.token1DailyData[r].fund1*this.token1DailyData[r].price1*10**this.decimal0):0),this.mmfRewardDailyData.forEach(n=>{this.mmfTotalReward+=n.mmfReward/10**this.decimal1;const r=i.indexOf(1e3*n.dayStartTimestamp);-1!==r&&(e[r]+=this.token1DailyData[r].fund1>0?n.mmfReward*this.token1DailyData[r].price1*365/this.token1DailyData[r].fund1*this.token1DailyData[r].price1:0)}),this.historicalAPY=e.map(n=>100*n),this.buildOption()}getCurrentEpochTiTiRewards(){return(new Date).getTime()>1e3*this.periodFinish?0:this.rewardRate*(1*this.periodFinish-1*this.startTime)/10**18}isZero(e){return 0===Number.parseFloat(e)}onStakingInputValueChange(e){this.stakingInputValue=(0,u.Y4)(e.target.value),e.target.value=this.stakingInputValue}onWithdrawInputValueChange(e){this.withdrawInputValue=(0,u.Y4)(e.target.value),e.target.value=this.withdrawInputValue}onClaimInputValueChange(e){this.claimInputValue=(0,u.Y4)(e.target.value),e.target.value=this.claimInputValue}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){this.fetchTotalStakedLPToken(),this.fetchBalanceOfStakedLPToken(),this.fetchBalanceOfToken1(),this.fetchBalanceOfmToken(),this.fetchClaimable(),Promise.all([this.fetchTiTiDailyPrice(),this.fetchEpochInfo(),this.fetchMMFRewardDailyData(),this.fetchMMFRewardHourDataIn24H(),this.fetchToken1DailyPrice(),this.fetchOption()]).then(()=>{this.calcHistoricalAPY()})}fetchOption(){return this.echartService.fetchOption("MMF-APY").then(e=>this.option=e)}buildOption(){this.option.series[0].data=this.historicalAPY,this.option=(0,D.cloneDeep)(this.option)}fetchTotalStakedLPToken(){this.web3Service.invokeContract("MMFLPStakingPool","totalSupply",[]).then(e=>{this.totalStakedLPToken=e[0]/10**this.decimal1})}fetchBalanceOfStakedLPToken(){this.accountService.getCurrentAccountAsyn().then(e=>this.web3Service.invokeContract("MMFLPStakingPool","balanceOf",[e]).then(i=>{this.stakedLPTokenBalance=i[0]/10**this.decimal1}))}fetchBalanceOfToken1(){this.accountService.getCurrentAccountAsyn().then(e=>this.web3Service.invokeContract(this.currentMMFPair.token1,"balanceOf",[e]).then(i=>{this.token1Balance=i[0]/10**this.decimal1}))}fetchBalanceOfmToken(){this.accountService.getCurrentAccountAsyn().then(e=>this.web3Service.invokeContract("MarketMakerFund","balanceOf",[e]).then(i=>{this.mTokenBalance=i[0]/10**6}))}fetchClaimable(){this.accountService.getCurrentAccountAsyn().then(e=>this.web3Service.invokeContract("MMFLPStakingPool","earned",[e]).then(i=>{this.claimableValue=i[0]/10**18;const n=Math.pow(10,4);this.claimInputValue=(0,u.Y4)(Math.floor(this.claimableValue*n)/n+"")}))}fetchEpochInfo(){return Promise.all([this.web3Service.invokeContract("MMFLPStakingPool","rewardRate",[]),this.web3Service.invokeContract("MMFLPStakingPool","epochNum",[]),this.web3Service.invokeContract("MMFLPStakingPool","startTime",[]),this.web3Service.invokeContract("MMFLPStakingPool","periodFinish",[])]).then(e=>{this.rewardRate=e[0][0],this.epochNum=e[1][0],this.startTime=e[2][0],this.periodFinish=e[3][0];const i=(new Date).getTime()/1e3;this.distributedTiTiRewards=0,this.distributedTiTiRewards+=this.rewardRate*((i>this.periodFinish?this.periodFinish:i)-this.startTime)/10**18}).then(()=>this.fetchHistoricalMMFStakingEpoch())}fetchTiTiDailyPrice(){return this.graphService.fetchUniwapPairDailyData().then(({data:e})=>{const i=Array(30).fill(null),n=(0,u.Gq)().reverse();e.uniswapPair.dailyData.forEach(s=>{const l=n.indexOf(1e3*s.dayStartTimestamp);-1!==l&&(i[l]=s.fund1/s.fund0)});let r=0;i.forEach((s,l)=>{null==s?i[l]=r:r=s}),this.titiDailyPrice=i})}fetchMMFRewardDailyData(){return this.graphService.fetchMMFRewardDailyData(p.wE.MAMMSwapPair).then(({data:e})=>{this.mmfRewardDailyData=e.pair.mmfRewardDailyData})}fetchMMFRewardHourDataIn24H(){return this.graphService.fetchMMFRewardHourDataIn24H(p.wE.MAMMSwapPair).then(({data:e})=>{this.mmfRewardIn24H=0,e.pair.mmfRewardHourData.forEach(i=>this.mmfRewardIn24H+=i.mmfReward/10**this.decimal1)})}fetchToken1DailyPrice(){return this.graphService.fetchMMFSwapPairDailyData(p.wE.MAMMSwapPair).then(({data:e})=>{const i=Array(30).fill(null),n=(0,u.Gq)().reverse();e.pair.pairDailyData.forEach(s=>{const l=n.indexOf(1e3*s.dayStartTimestamp);-1!==l&&(i[l]={price1:s.fund0*10**this.decimal1/(s.fund1*10**this.decimal0),fund1:s.fund1})});let r={price1:0,fund1:0};i.forEach((s,l)=>{null==s?i[l]=r:r=s}),this.token1DailyData=i})}fetchHistoricalMMFStakingEpoch(){return this.graphService.fetchHistoricalMMFStakingEpoch(this.epochNum).then(({data:e})=>{e.mmfstakingEpoches.forEach(i=>this.distributedTiTiRewards+=i.totalReward)})}onStake(){const e=Math.pow(10,4),i=new(h())((0,u.uM)(this.stakingInputValue)).mul(new(h())("10").pow(new(h())(this.decimal1))).div(new(h())(e));this.web3Service.openApproveModal(this.currentMMFPair.token1,i,"MarketMakerFund",n=>{n&&this.web3Service.invokeContract("MarketMakerFund","addLiquidity",[i.toString(),!0]).then(r=>{})})}onWithdraw(){const e=Math.pow(10,4),i=new(h())((0,u.uM)(this.withdrawInputValue)).mul(new(h())("10").pow(new(h())(this.decimal1))).div(new(h())(e));this.web3Service.invokeContract("MarketMakerFund","removeLiquidity",[i.toString(),!0]).then(n=>{})}onClaim(){const e=Math.pow(10,4),i=(Math.floor(this.claimableValue*e*10**18)/e).toFixed(0);this.web3Service.invokeContract("MMFLPStakingPool","getReward",[]).then(n=>{a.e(797).then(a.bind(a,51797)).then(({TitiStakingModalComponent:r})=>{this.dialog.open(r).afterClosed().subscribe(l=>{l&&this.web3Service.openApproveModal("TiTiToken",new(h())(i),"TiTiStaking",M=>{M&&this.accountService.getCurrentAccountAsyn().then(v=>this.web3Service.invokeContract("TiTiStaking","stake",[v,new(h())(i).toString()]).then(N=>{}))})})})},n=>{})}onWithdrawAll(){this.web3Service.invokeContract("MarketMakerFund","withdrawAll",[]).then(e=>{})}maxStakeInputValue(){const e=Math.pow(10,4);this.stakingInputValue=(Math.floor(this.token1Balance*e)/e).toFixed(4)}maxWithdrawInputValue(){const e=Math.pow(10,4);this.withdrawInputValue=(Math.floor(this.stakedLPTokenBalance*e)/e).toFixed(4)}maxClaimInputValue(){const e=Math.pow(10,4);this.claimInputValue=(Math.floor(this.claimableValue*e)/e).toFixed(4)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(b.B),t.Y36(p.Uc),t.Y36(g.jv),t.Y36(U.H7),t.Y36(x.h),t.Y36(F.p),t.Y36(I.g),t.Y36(V.uw))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-mmf"]],decls:101,vars:51,consts:[[1,"mmf-wrapper"],[1,"mmf-card","mat-elevation-z4"],[2,"justify-self","center"],[2,"justify-self","start"],[2,"justify-self","end"],["text","xxxxxxxxxxxxxxxxxxxxx"],["appearance","outline",1,"mmf-input"],["matInput","","type","text",2,"font-size","18px",3,"ngModel","input"],["matPrefix","","svgIcon","USDC",2,"padding-right","12px"],["matSuffix","","mat-flat-button","",2,"margin-bottom","12px","background-color","transparent","color","#2DD6B5",3,"click"],["mat-raised-button","","color","primary",1,"mmf-input-btn",3,"disabled","click"],["type","text","matInput","",2,"font-size","18px",3,"ngModel","input"],["type","text","matInput","","disabled","",2,"font-size","18px",3,"ngModel","input"],["matPrefix","","svgIcon","TiTi",2,"padding-right","12px"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[2,"justify-self","center","grid-column-start","span 2"],[2,"justify-self","start","grid-column-start","span 2"],[2,"justify-self","end","grid-column-start","span 2"],[1,"pool-chart"],[2,"width","100%","height","100%",3,"option"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t._UZ(2,"div"),t.TgZ(3,"h2",2),t._uU(4,"USDC-MMF"),t.qZA(),t._UZ(5,"div"),t.TgZ(6,"span",3),t._uU(7,"Total Staked Value:"),t.qZA(),t._UZ(8,"div"),t.TgZ(9,"span",4),t._uU(10),t.ALo(11,"numberFormat"),t.qZA(),t.TgZ(12,"span",3),t._uU(13,"Your Staked Value:"),t.qZA(),t._UZ(14,"div"),t.TgZ(15,"span",4),t._uU(16),t.ALo(17,"numberFormat"),t.qZA(),t.TgZ(18,"span",3),t._uU(19,"Dynamic APY"),t._UZ(20,"titi-tooltip",5),t._uU(21,":"),t.qZA(),t._UZ(22,"div"),t.TgZ(23,"span",4),t._uU(24),t.ALo(25,"numberFormat"),t.qZA(),t.TgZ(26,"span",3),t._uU(27,"Claimable Rewards"),t._UZ(28,"titi-tooltip",5),t._uU(29," :"),t.qZA(),t._UZ(30,"div"),t.TgZ(31,"span",4),t._uU(32),t.ALo(33,"numberFormat"),t.qZA(),t.TgZ(34,"mat-form-field",6),t.TgZ(35,"mat-label"),t._uU(36),t.ALo(37,"numberFormat"),t.qZA(),t.TgZ(38,"input",7),t.NdJ("input",function(r){return i.onStakingInputValueChange(r)}),t.qZA(),t._UZ(39,"mat-icon",8),t.TgZ(40,"button",9),t.NdJ("click",function(){return i.maxStakeInputValue()}),t._uU(41,"MAX"),t.qZA(),t.qZA(),t.TgZ(42,"button",10),t.NdJ("click",function(){return i.onStake()}),t._uU(43,"STAKE"),t.qZA(),t.TgZ(44,"mat-form-field",6),t.TgZ(45,"mat-label"),t._uU(46),t.ALo(47,"numberFormat"),t.qZA(),t.TgZ(48,"input",11),t.NdJ("input",function(r){return i.onWithdrawInputValueChange(r)}),t.qZA(),t._UZ(49,"mat-icon",8),t.TgZ(50,"button",9),t.NdJ("click",function(){return i.maxWithdrawInputValue()}),t._uU(51,"MAX"),t.qZA(),t.qZA(),t.TgZ(52,"button",10),t.NdJ("click",function(){return i.onWithdraw()}),t._uU(53,"WITHDRAW"),t.qZA(),t.TgZ(54,"mat-form-field",6),t.TgZ(55,"mat-label"),t._uU(56),t.ALo(57,"numberFormat"),t.qZA(),t.TgZ(58,"input",12),t.NdJ("input",function(r){return i.onClaimInputValueChange(r)}),t.qZA(),t._UZ(59,"mat-icon",13),t.TgZ(60,"button",9),t.NdJ("click",function(){return i.maxClaimInputValue()}),t._uU(61,"MAX"),t.qZA(),t.qZA(),t.TgZ(62,"button",10),t.NdJ("click",function(){return i.onClaim()}),t._uU(63,"CLAIM"),t.qZA(),t.qZA(),t.TgZ(64,"div",14),t.TgZ(65,"h2",15),t._uU(66,"USDC Pool Info"),t.qZA(),t._UZ(67,"mat-divider"),t.TgZ(68,"mat-chip-list",16),t.TgZ(69,"mat-chip"),t._uU(70,"Yield"),t.qZA(),t.qZA(),t._UZ(71,"mat-divider"),t.TgZ(72,"span",17),t._uU(73,"Distributed Slippage Rewards:"),t.qZA(),t.TgZ(74,"span",18),t._uU(75),t.ALo(76,"numberFormat"),t.qZA(),t.TgZ(77,"span",17),t._uU(78,"24H Slippage Rewards:"),t.qZA(),t.TgZ(79,"span",18),t._uU(80),t.ALo(81,"numberFormat"),t.qZA(),t.TgZ(82,"span",17),t._uU(83,"Distributed TiTi Rewards"),t._UZ(84,"titi-tooltip",5),t._uU(85,":"),t.qZA(),t.TgZ(86,"span",18),t._uU(87),t.ALo(88,"numberFormat"),t.qZA(),t.TgZ(89,"span",17),t._uU(90,"Current Epoch TiTi Rewards:"),t.qZA(),t.TgZ(91,"span",18),t._uU(92),t.ALo(93,"numberFormat"),t.qZA(),t._UZ(94,"mat-divider"),t.TgZ(95,"mat-chip-list",16),t.TgZ(96,"mat-chip"),t._uU(97,"Historical APY"),t.qZA(),t.qZA(),t._UZ(98,"mat-divider"),t.TgZ(99,"div",19),t._UZ(100,"titi-chart-wrapper",20),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(10),t.hij("$",t.xi3(11,18,i.totalStakedLPToken,4),""),t.xp6(6),t.hij("$",t.xi3(17,21,i.stakedLPTokenBalance,4),""),t.xp6(8),t.hij("",t.xi3(25,24,i.historicalAPY[i.historicalAPY.length-1],4),"%"),t.xp6(8),t.hij("",t.xi3(33,27,i.claimableValue,4)," TiTi"),t.xp6(4),t.hij("Balance:",t.xi3(37,30,i.token1Balance,4)," USDC"),t.xp6(2),t.Q6J("ngModel",i.stakingInputValue),t.xp6(4),t.Q6J("disabled",!i.stakingInputValue||i.isZero(i.stakingInputValue)),t.xp6(4),t.hij("Staked:",t.xi3(47,33,i.stakedLPTokenBalance,4)," USDC"),t.xp6(2),t.Q6J("ngModel",i.withdrawInputValue),t.xp6(4),t.Q6J("disabled",!i.withdrawInputValue||i.isZero(i.withdrawInputValue)),t.xp6(4),t.hij("Claimable:",t.xi3(57,36,i.claimableValue,4)," TiTi"),t.xp6(2),t.Q6J("ngModel",i.claimInputValue),t.xp6(4),t.Q6J("disabled",!i.claimInputValue||i.isZero(i.claimInputValue)),t.xp6(13),t.hij("",t.xi3(76,39,i.mmfTotalReward,4)," USDC"),t.xp6(5),t.hij("",t.xi3(81,42,i.mmfRewardIn24H,4)," USDC"),t.xp6(7),t.hij("",t.xi3(88,45,i.distributedTiTiRewards,4)," TiTi"),t.xp6(5),t.hij("",t.xi3(93,48,i.getCurrentEpochTiTiRewards(),4)," TiTi"),t.xp6(8),t.Q6J("option",i.option))},directives:[R.Q,d.KE,d.hX,S.Nt,m.Fj,m.JJ,m.On,g.Hw,d.qo,k.lW,d.R9,A.d,T.qn,T.HS,L.o],pipes:[O.p],styles:[".mmf-wrapper[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:16fr 10fr 1fr;grid-column-gap:48px;column-gap:48px}.mmf-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;padding:24px 48px;display:grid;grid-template-columns:1fr 1fr 1fr;grid-row-gap:24px;row-gap:24px;align-items:center}.mmf-input[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3}.mmf-btn[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4}.mmf-input-btn[_ngcontent-%COMP%]{width:80%;justify-self:end;margin-bottom:18px;height:56px}.pool-info-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;padding:26px 24px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr;grid-row-gap:24px;row-gap:24px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:span 4;justify-self:center}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:5;justify-self:center;width:100%;height:100%}@media screen and (max-width: 1024px){.mmf-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;display:grid;grid-template-columns:1fr;grid-row-gap:12px;row-gap:12px;margin:0}.mmf-card[_ngcontent-%COMP%]{width:100%;padding:12px}}"]}),o})()}];let H=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[Z.Bz.forChild(j)],Z.Bz]}),o})();var B=a(45922),Y=a(87841);let E=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[P.ez,H,m.u5,S.c,k.ot,g.Ps,A.t,T.Hi,B.F,Y.m]]}),o})()}}]);