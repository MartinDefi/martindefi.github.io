"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[689],{43689:(dt,x,o)=>{o.r(x),o.d(x,{Use2earnModule:()=>mt});var y=o(69808),T=o(91083),Z=o(98538),h=o.n(Z),C=o(32935),p=o(54898);class m{constructor(e){this.elements=[...e],this.elements.sort(Buffer.compare),this.elements=m.bufDedup(this.elements),this.bufferElementPositionIndex=this.elements.reduce((n,i,a)=>(n[(0,p.bufferToHex)(i)]=a,n),{}),this.layers=this.getLayers(this.elements)}getLayers(e){if(0===e.length)throw new Error("empty tree");const n=[];for(n.push(e);n[n.length-1].length>1;)n.push(this.getNextLayer(n[n.length-1]));return n}getNextLayer(e){return e.reduce((n,i,a,s)=>(a%2==0&&n.push(m.combinedHash(i,s[a+1])),n),[])}static combinedHash(e,n){return e?n?(0,p.keccak256)(m.sortAndConcat(e,n)):e:n}getRoot(){return this.layers[this.layers.length-1][0]}getHexRoot(){return(0,p.bufferToHex)(this.getRoot())}getProof(e){const n=(0,p.bufferToHex)(e);let i=this.bufferElementPositionIndex[n];if("number"!=typeof i)throw new Error("Element does not exist in Merkle tree");return this.layers.reduce((a,s)=>{const c=m.getPairElement(i,s);return c&&a.push(c),i=Math.floor(i/2),a},[])}getHexProof(e){const n=this.getProof(e);return m.bufArrToHexArr(n)}static getPairElement(e,n){const i=e%2==0?e+1:e-1;return i<n.length?n[i]:null}static bufDedup(e){return e.filter((n,i)=>0===i||!e[i-1].equals(n))}static bufArrToHexArr(e){if(e.some(n=>!Buffer.isBuffer(n)))throw new Error("Array is not an array of buffers");return e.map(n=>"0x"+n.toString("hex"))}static sortAndConcat(...e){return Buffer.concat([...e].sort(Buffer.compare))}}var l=o(10499),v=o(92547),A=o(63544),D=o(88666);const S=new RegExp("^bytes([0-9]+)$"),P=new RegExp("^(u?int)([0-9]*)$"),M=new RegExp("^(.*)\\[([0-9]*)\\]$"),d=new D.Yd("solidity/5.6.0");function b(r,e,n){switch(r){case"address":return n?(0,l.Bu)(e,32):(0,l.lE)(e);case"string":return(0,A.Y0)(e);case"bytes":return(0,l.lE)(e);case"bool":return e=e?"0x01":"0x00",n?(0,l.Bu)(e,32):(0,l.lE)(e)}let i=r.match(P);if(i){let a=parseInt(i[2]||"256");return(i[2]&&String(a)!==i[2]||a%8!=0||0===a||a>256)&&d.throwArgumentError("invalid number type","type",r),n&&(a=256),e=C.O$.from(e).toTwos(a),(0,l.Bu)(e,a/8)}if(i=r.match(S),i){const a=parseInt(i[1]);return(String(a)!==i[1]||0===a||a>32)&&d.throwArgumentError("invalid bytes type","type",r),(0,l.lE)(e).byteLength!==a&&d.throwArgumentError(`invalid value for ${r}`,"value",e),n?(0,l.lE)((e+"0000000000000000000000000000000000000000000000000000000000000000").substring(0,66)):e}if(i=r.match(M),i&&Array.isArray(e)){const a=i[1];parseInt(i[2]||String(e.length))!=e.length&&d.throwArgumentError(`invalid array length for ${r}`,"value",e);const c=[];return e.forEach(function(f){c.push(b(a,f,!0))}),(0,l.zo)(c)}return d.throwArgumentError("invalid type","type",r)}function w(r,e){r.length!=e.length&&d.throwArgumentError("wrong number of values; expected ${ types.length }","values",e);const n=[];return r.forEach(function(i,a){n.push(b(i,e[a]))}),(0,l.Dv)((0,l.zo)(n))}class g{constructor(e){this.tree=new m(e.map(({account:n,amount:i})=>g.toNode(n,i)))}static verifyProof(e,n,i,a){let s=g.toNode(e,n);for(const c of i)s=m.combinedHash(s,c);return s.equals(a)}static toNode(e,n){return Buffer.from(function(r,e){return(0,v.w)(w(["address","uint256"],e))}(0,[e,n]).substr(2),"hex")}getHexRoot(){return this.tree.getHexRoot()}getProof(e,n){return this.tree.getHexProof(g.toNode(e,n))}}var N=o(28321),t=o(5e3),E=o(32681),Y=o(31657),B=o(48966),L=o(11730),H=o(94602),$=o(92134),U=o(47423),u=o(32075),Q=o(75303);function z(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Act."),t.qZA())}function F(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.Oqu(n.act)}}function q(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Total Rewards"),t.qZA())}function j(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.total,2)," TiTi")}}function J(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Pending Rewards"),t.qZA())}function k(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.personal,2)," TiTi")}}function I(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Expected Daily Rewards"),t.qZA())}function X(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.rate,2)," TiTi/Day")}}function G(r,e){1&r&&t._UZ(0,"tr",24)}function W(r,e){if(1&r){const n=t.EpF();t.TgZ(0,"tr",25),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw().onRowClick(s)}),t.qZA()}}function K(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Act."),t.qZA())}function V(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.Oqu(n.act)}}function tt(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Total Rewards"),t.qZA())}function et(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.total,2)," TiTi")}}function nt(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Pending Rewards"),t.qZA())}function rt(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.personal,2)," TiTi")}}function it(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Expected Daily Rewards"),t.qZA())}function at(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.rate,2)," TiTi/Day")}}function ot(r,e){1&r&&t._UZ(0,"tr",24)}function st(r,e){if(1&r){const n=t.EpF();t.TgZ(0,"tr",25),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw().onRowClick(s)}),t.qZA()}}const ct=[{path:"",component:(()=>{class r{constructor(n,i,a,s,c,f){this.router=n,this.use2earnService=i,this.refreshService=a,this.dialog=s,this.web3Service=c,this.accountService=f,this.isLoading=!1,this.displayedColumns=["act","total","personal","rate"],this.dataSource1=[],this.dataSource2=[],this.claimedRewards=0,this.claimedRewardsTreeData="0",this.totalClaimableTreeData="0",this.treeData=[],this.clickedRows=new Set}get claimableRewards(){return new(h())(this.totalClaimableTreeData).sub(new(h())(this.totalClaimableTreeData)).toNumber()}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){this.fetchUserData().then(()=>this.buildDataSource()),this.fetchClaimedRewards(),this.fetchTreeData()}fetchClaimedRewards(){this.accountService.getCurrentAccountAsyn().then(n=>this.web3Service.invokeContract("TiTiMerkleDistributor","claimed",[n])).then(n=>{this.claimedRewardsTreeData=n[0],this.claimedRewards=n[0]/10**18})}fetchUserData(){return this.use2earnService.fetchUserData()}fetchTreeData(){Promise.all([fetch("/assets/use2earn/treeData.json").then(n=>n.text()).then(n=>JSON.parse(n)),this.accountService.getCurrentAccountAsyn()]).then(([n,i])=>{this.treeData=n,this.treeData.forEach(a=>{a.account.toLowerCase()===i.toLowerCase()&&(this.use2earnService.totalClaimableRewards=new(h())((0,N.uM)(a.amount)).div(new(h())("10").pow(new(h())("18"))).toNumber()/1e4,this.totalClaimableTreeData=a.amount)}),this.balanceTree=new g(this.treeData.map(a=>({account:a.account.toLowerCase(),amount:C.O$.from(a.amount)})))})}buildDataSource(){this.dataSource1=[{act:"Buy TiUSD in MAMM",total:this.use2earnService.buyTiUSDReward,personal:this.use2earnService.buyTiUSDPersonalReward,rate:this.use2earnService.buyTiUSDPersonalRewardRate,url:"/use2earn/activity/buyTiUSD"},{act:"TiUSD Holder",total:this.use2earnService.holdTiUSDReward,personal:this.use2earnService.holdTiUSDPersonalReward,rate:this.use2earnService.holdTiUSDPersonalRewardRate,url:"/use2earn/activity/holdTiUSD"}],this.dataSource2=[{act:"Buy TiTi in Uniswap",total:this.use2earnService.buyTiTiReward,personal:this.use2earnService.buyTiTiPersonalReward,rate:this.use2earnService.buyTiTiPersonalRewardRate,url:"/use2earn/activity/buyTiTi"}]}onRowClick(n){this.router.navigateByUrl(n.url)}onClaim(){this.isLoading=!0,o.e(797).then(o.bind(o,51797)).then(({TitiStakingModalComponent:n})=>{this.dialog.open(n).afterClosed().subscribe(a=>this.accountService.getCurrentAccountAsyn().then(s=>{const c=C.O$.from(this.totalClaimableTreeData),f=this.balanceTree.getProof(s.toLowerCase(),c);return this.web3Service.invokeContract("TiTiMerkleDistributor",a?"claimAndStake":"claim",[c.toString(),f])}).then(()=>this.isLoading=!1,()=>this.isLoading=!1))})}}return r.\u0275fac=function(n){return new(n||r)(t.Y36(T.F0),t.Y36(E.Q),t.Y36(Y.g),t.Y36(B.uw),t.Y36(L.Uc),t.Y36(H.B))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-use2earn"]],decls:60,vars:20,consts:[[1,"use2earn-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Accumulated TiTi Rewards distributed to use-to-earn behaviors."],[1,"value"],["text","Accural of unclaimable rewards in your account until the distribution is triggered."],["text","Accural of claimable rewards in your account at anytime."],["mat-raised-button","","color","primary",1,"action-btn",3,"disabled","click"],[1,"mat-elevation-z4","activity-table-wrapper"],["mat-table","",1,"activity-table",3,"dataSource"],["matColumnDef","act"],["mat-header-cell","","class"," left-align",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["mat-header-cell","","class"," right-align",4,"matHeaderCellDef"],["mat-cell","","class"," right-align",4,"matCellDef"],["matColumnDef","personal"],["matColumnDef","rate"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"left-align"],["mat-cell",""],["mat-header-cell","",1,"right-align"],["mat-cell","",1,"right-align"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"Distributed TiTi Rewards"),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(8,"div",1),t.TgZ(9,"h2",2),t._uU(10,"Your Pending Rewards"),t._UZ(11,"titi-tooltip",5),t.qZA(),t.TgZ(12,"span",4),t._uU(13),t.ALo(14,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(15,"div",1),t.TgZ(16,"h2",2),t._uU(17,"Your Claimable Rewards"),t._UZ(18,"titi-tooltip",6),t.qZA(),t.TgZ(19,"span",4),t._uU(20),t.ALo(21,"numberFormat"),t.qZA(),t.TgZ(22,"button",7),t.NdJ("click",function(){return i.onClaim()}),t._uU(23),t.qZA(),t.qZA(),t.TgZ(24,"div",8),t.TgZ(25,"h2"),t._uU(26,"Inter-Protocol Behaviors"),t.qZA(),t.TgZ(27,"table",9),t.ynx(28,10),t.YNc(29,z,2,0,"th",11),t.YNc(30,F,2,1,"td",12),t.BQk(),t.ynx(31,13),t.YNc(32,q,2,0,"th",14),t.YNc(33,j,3,4,"td",15),t.BQk(),t.ynx(34,16),t.YNc(35,J,2,0,"th",14),t.YNc(36,k,3,4,"td",15),t.BQk(),t.ynx(37,17),t.YNc(38,I,2,0,"th",14),t.YNc(39,X,3,4,"td",15),t.BQk(),t.YNc(40,G,1,0,"tr",18),t.YNc(41,W,1,0,"tr",19),t.qZA(),t.qZA(),t.TgZ(42,"div",8),t.TgZ(43,"h2"),t._uU(44,"Ex-Protocol Behaviors"),t.qZA(),t.TgZ(45,"table",9),t.ynx(46,10),t.YNc(47,K,2,0,"th",11),t.YNc(48,V,2,1,"td",12),t.BQk(),t.ynx(49,13),t.YNc(50,tt,2,0,"th",14),t.YNc(51,et,3,4,"td",15),t.BQk(),t.ynx(52,16),t.YNc(53,nt,2,0,"th",14),t.YNc(54,rt,3,4,"td",15),t.BQk(),t.ynx(55,17),t.YNc(56,it,2,0,"th",14),t.YNc(57,at,3,4,"td",15),t.BQk(),t.YNc(58,ot,1,0,"tr",18),t.YNc(59,st,1,0,"tr",19),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(6),t.hij("",t.xi3(7,11,i.use2earnService.distributedTiTiRewards,2)," TiTi"),t.xp6(7),t.hij("",t.xi3(14,14,i.use2earnService.buyTiUSDPersonalReward+i.use2earnService.holdTiUSDPersonalReward+i.use2earnService.buyTiTiPersonalReward,2)," TiTi"),t.xp6(7),t.hij("",t.xi3(21,17,i.claimableRewards,2)," TiTi"),t.xp6(2),t.Q6J("disabled",i.claimableRewards<=0||i.isLoading),t.xp6(1),t.Oqu(i.isLoading?"waiting...":"CLAIM"),t.xp6(4),t.Q6J("dataSource",i.dataSource1),t.xp6(13),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(4),t.Q6J("dataSource",i.dataSource2),t.xp6(13),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns))},directives:[$.Q,U.lW,u.BZ,u.w1,u.fO,u.Dz,u.as,u.nj,u.ge,u.ev,u.XQ,u.Gk],pipes:[Q.p],styles:[".mat-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid transparent;border-top:1px solid transparent;cursor:pointer}.mat-row[_ngcontent-%COMP%]:hover   .mat-cell[_ngcontent-%COMP%]{border-color:#1de9b6}.use2earn-wrapper[_ngcontent-%COMP%]{padding:12px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr 1fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:120px;padding:18px;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 4;margin-left:12px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 3;align-self:end;font-size:18px;margin-left:12px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.activity-table-wrapper[_ngcontent-%COMP%]{grid-column-start:span 3;padding:12px;display:flex;align-items:center;flex-direction:column;min-height:360px}.activity-table[_ngcontent-%COMP%]{width:100%;background-color:transparent}.activity-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .activity-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:0 4px}.activity-table[_ngcontent-%COMP%]   .left-align[_ngcontent-%COMP%]{text-align:left}.activity-table[_ngcontent-%COMP%]   .right-align[_ngcontent-%COMP%]{text-align:right}@media screen and (max-width: 1024px){.use2earn-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;margin:0;display:grid;grid-template-columns:1fr;grid-row-gap:12px;row-gap:12px;grid-column-gap:0;column-gap:0}.biz-info-card[_ngcontent-%COMP%]{width:100%;margin:0;min-height:80px}.activity-table-wrapper[_ngcontent-%COMP%]{width:100%;margin:0;padding:12px}}"]}),r})()}];let lt=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[T.Bz.forChild(ct)],T.Bz]}),r})();var ut=o(87841);let mt=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[y.ez,lt,u.p0,U.ot,ut.m]]}),r})()}}]);