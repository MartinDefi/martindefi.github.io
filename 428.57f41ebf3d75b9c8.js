"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[428],{38428:(j,m,a)=>{a.r(m),a.d(m,{TiusdModule:()=>P});var f=a(69808),v=a(91083),d=a(17489),y=a(28321),u=a(11730),t=a(5e3),Z=a(53405),R=a(74696),x=a(31657),A=a(92134),U=a(11523),T=a(4834),g=a(26688),S=a(75303);function F(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"span",15),t._uU(2),t.qZA(),t.TgZ(3,"span",16),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&n){const e=o.$implicit,i=o.index,s=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,s.currentReserveRatio[i],4),"")}}function C(n,o){if(1&n&&(t.ynx(0),t.TgZ(1,"span",15),t._uU(2),t.qZA(),t.TgZ(3,"span",16),t._uU(4),t.ALo(5,"numberFormat"),t.qZA(),t.BQk()),2&n){const e=o.$implicit,i=o.index,s=t.oxw();t.xp6(2),t.hij("",e,":"),t.xp6(2),t.hij("$ ",t.xi3(5,2,s.currentRainydayFundRatio[i],4),"")}}const M=[{path:"",component:(()=>{class n{constructor(e,i,s,r){this.graphService=e,this.echartService=i,this.web3Service=s,this.refreshService=r,this.option1={},this.option2={},this.option3={},this.option4={},this.TiUSDCirculation=0,this.TiUSDPrice=1,this.reserveRatio=0,this.totalReserve=0,this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalRainydayFund=0,this.currentRainydayFundRatio=[],this.dailyRainydayFundValue=[]}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){Promise.all([this.fetchReserves(),this.fetchOptions()]).then(()=>{this.buildOption(),this.fetchTiUSDInfo()})}buildOption(){this.option1.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyReserveValue[i]})),this.option3.series=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],type:"bar",stack:"total",label:{show:!1},emphasis:{focus:"series"},data:this.dailyRainydayFundValue[i]})),this.option2.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentReserveRatio[i]})),this.option4.series[0].data=Array(this.reserveNames.length).fill(null).map((e,i)=>({name:this.reserveNames[i],value:this.currentRainydayFundRatio[i]})),this.option1=(0,d.cloneDeep)(this.option1),this.option2=(0,d.cloneDeep)(this.option2),this.option3=(0,d.cloneDeep)(this.option3),this.option4=(0,d.cloneDeep)(this.option4)}fetchOptions(){return Promise.all([this.echartService.fetchOption("TiUSD-Reserve-Bar"),this.echartService.fetchOption("TiUSD-Reserve-Pie"),this.echartService.fetchOption("RainydayFund-Bar"),this.echartService.fetchOption("RainydayFund-Pie")]).then(e=>{this.option1=e[0],this.option2=e[1],this.option3=e[2],this.option4=e[3]})}fetchReserves(){return this.graphService.fetchAllSwapPairDailyData().then(({data:e})=>{const i=e.pairs;this.reserveNames=[],this.currentReserveRatio=[],this.dailyReserveValue=[],this.totalReserve=0,i.forEach(s=>{this.reserveNames.push(s.token1.symbol),this.currentReserveRatio.push(1*s.prv),this.totalReserve+=1*s.prv;const r=Array(30).fill(null),p=(0,y.Gq)().reverse();s.pairDailyData.forEach(h=>{const c=p.indexOf(1e3*h.dayStartTimestamp);-1!==c&&(r[c]=1*h.prv)});let l=0;r.forEach((h,c)=>{null===h?r[c]=l:l=h}),this.dailyReserveValue.push(r)})}).then(()=>this.fetchRainydayFund())}fetchRainydayFund(){return this.graphService.fetchVaultFund(u.wE.RainyDayFundVault.toLowerCase()).then(({data:e})=>{const i=e.fundVault?e.fundVault.dailyBalance:[];this.dailyRainydayFundValue=Array(this.reserveNames.length).fill(Array(30).fill(null));const s=(0,y.Gq)().reverse();i.forEach(r=>{const p=s.indexOf(1e3*r.dayStartTimestamp),l=this.reserveNames.indexOf(r.token.symbol);-1!==p&&-1!==l&&(this.dailyRainydayFundValue[l][p]=r.balance/r.token.decimals)}),this.dailyRainydayFundValue.forEach(r=>{let p=0;r.forEach((l,h)=>{null===l?r[h]=p:p=l})}),this.totalRainydayFund=0,this.currentRainydayFundRatio=this.dailyRainydayFundValue.map(r=>(this.totalRainydayFund+=r[r.length-1],r[r.length-1]))})}fetchTiUSDInfo(){Promise.all([this.web3Service.invokeContract("TiUSD","totalSupply",[]),this.web3Service.invokeContract("TiUSD","balanceOf",[u.wE.MAMMSwapPair]),this.web3Service.invokeContract("MAMMSwapPair","getTiUSDPrice",[]),this.web3Service.invokeContract("MAMMSwapPair","getDepth",[])]).then(([e,i,s,r])=>{this.TiUSDCirculation=e[0]/10**18-i[0]/10**18,this.TiUSDPrice=s[1]&&s[0]/10**18||1,this.reserveRatio=100*(this.totalReserve+this.totalRainydayFund)/this.TiUSDCirculation})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z.h),t.Y36(R.p),t.Y36(u.Uc),t.Y36(x.g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-tiusd"]],decls:56,vars:26,consts:[[1,"tisud-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Current price of TiUSD in MAMM"],[1,"value"],["text","TiUSD Circulation = TiUSD Total supply - TiUSD in MAMM"],["text","The ratio of the total reserve value to the total circulation of TiUSD"],[1,"mat-elevation-z4","chart-wrapper"],[2,"width","100%","height","100%",3,"option"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[4,"ngFor","ngForOf"],[2,"grid-column-start","1","grid-column-end","3","display","grid","grid-template-columns","2fr 3fr 2fr","align-items","center"],[2,"justify-self","center"],[1,"pool-chart"],[2,"justify-self","start"],[2,"justify-self","end"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiUSD Price"),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(8,"div",1),t.TgZ(9,"h2",2),t._uU(10,"TiUSD Circulation"),t._UZ(11,"titi-tooltip",5),t.qZA(),t.TgZ(12,"span",4),t._uU(13),t.ALo(14,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(15,"div",1),t.TgZ(16,"h2",2),t._uU(17,"Reserve Ratio"),t._UZ(18,"titi-tooltip",6),t.qZA(),t.TgZ(19,"span",4),t._uU(20),t.ALo(21,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(22,"div",7),t._UZ(23,"titi-chart-wrapper",8),t.qZA(),t.TgZ(24,"div",9),t.TgZ(25,"h2",10),t._uU(26,"Total Reserve Value"),t.qZA(),t.TgZ(27,"h3",10),t._uU(28),t.ALo(29,"numberFormat"),t.qZA(),t.YNc(30,F,6,5,"ng-container",11),t.TgZ(31,"div",12),t._UZ(32,"mat-divider"),t.TgZ(33,"mat-chip-list",13),t.TgZ(34,"mat-chip"),t._uU(35,"Reserve Ratio"),t.qZA(),t.qZA(),t._UZ(36,"mat-divider"),t.qZA(),t.TgZ(37,"div",14),t._UZ(38,"titi-chart-wrapper",8),t.qZA(),t.qZA(),t.TgZ(39,"div",7),t._UZ(40,"titi-chart-wrapper",8),t.qZA(),t.TgZ(41,"div",9),t.TgZ(42,"h2",10),t._uU(43,"Rainy Day Fund"),t.qZA(),t.TgZ(44,"h3",10),t._uU(45),t.ALo(46,"numberFormat"),t.qZA(),t.YNc(47,C,6,5,"ng-container",11),t.TgZ(48,"div",12),t._UZ(49,"mat-divider"),t.TgZ(50,"mat-chip-list",13),t.TgZ(51,"mat-chip"),t._uU(52,"Ratio"),t.qZA(),t.qZA(),t._UZ(53,"mat-divider"),t.qZA(),t.TgZ(54,"div",14),t._UZ(55,"titi-chart-wrapper",8),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.hij("$ ",t.xi3(7,11,i.TiUSDPrice,4),""),t.xp6(7),t.Oqu(t.xi3(14,14,i.TiUSDCirculation,4)),t.xp6(7),t.hij("",t.xi3(21,17,i.reserveRatio,4),"%"),t.xp6(3),t.Q6J("option",i.option1),t.xp6(5),t.hij("$ ",t.xi3(29,20,i.totalReserve,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option2),t.xp6(2),t.Q6J("option",i.option3),t.xp6(5),t.hij("$ ",t.xi3(46,23,i.totalRainydayFund,4),""),t.xp6(2),t.Q6J("ngForOf",i.reserveNames),t.xp6(8),t.Q6J("option",i.option4))},directives:[A.Q,U.o,f.sg,T.d,g.qn,g.HS],pipes:[S.p],styles:[".tisud-wrapper[_ngcontent-%COMP%]{padding:12px 24px 24px 12px;display:grid;grid-template-columns:2fr 2fr 2fr 2fr 2fr 2fr 0fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;width:100%;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;margin-left:48px;align-self:end;font-size:18px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.chart-wrapper[_ngcontent-%COMP%]{grid-column-start:span 4;align-self:start;justify-self:start;width:100%;padding:12px 18px;height:100%}.pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 2;align-self:start;justify-self:start;width:100%;height:100%;padding:12px 18px;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:40px 40px 40px auto;grid-row-gap:12px;row-gap:12px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;height:40px;font-size:20px;justify-self:center;align-self:start}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3;justify-self:center;width:100%;height:100%}@media screen and (max-width: 1024px){.tisud-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr;width:100%;padding:12px;grid-row-gap:12px;row-gap:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px}.chart-wrapper[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{grid-column-start:span 1;padding:18px 48px;height:auto}}"]}),n})()}];let D=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[v.Bz.forChild(M)],v.Bz]}),n})();var O=a(45922),w=a(87841);let P=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[f.ez,D,T.t,g.Hi,O.F,w.m]]}),n})()}}]);