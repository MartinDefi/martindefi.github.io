"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[419],{82419:(N,d,a)=>{a.r(d),a.d(d,{SwapModule:()=>k});var Z=a(69808),U=a(93075),g=a(91083),f=a(11730),T=a(98538),o=a.n(T),M=a(28321),y=a(17489),t=a(5e3),l=a(68326),x=a(22313),F=a(48966),A=a(53405),C=a(74696),D=a(31657),h=a(67322),m=a(77531),P=a(92134),v=a(47423),S=a(4834),c=a(26688),V=a(11523),I=a(75303);const w=[{token0:"TiUSD",token1:"USDC"}];let O=(()=>{class e{constructor(n,i,s,r,p,J,H){this.web3Service=s,this.dialog=r,this.graphService=p,this.echartService=J,this.refreshService=H,this.isBuyingTiUSD=!0,this.swapPairList=w,this.currentSwapPair=w[0],this.inputValue=0,this.outputValue=0,this.fund0=0,this.fund1=0,this.decimal0=18,this.decimal1=6,this.priceImpact="0.00%",this.MMFfund=0,this.lastFund0=0,this.lastFund1=0,this.chartData=[],this.option={},n.addSvgIconLiteral("USDC",i.bypassSecurityTrustHtml(B)),n.addSvgIconLiteral("TiUSD",i.bypassSecurityTrustHtml(b))}get prv(){return Math.abs(this.lastFund1-this.MMFfund)+(this.lastFund0-this.fund0)}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){this.fetchPoolInfo(),this.fetchMMFFund(),this.fetchLastfund0(),this.fetchLastfund1(),this.fetchOption().then(()=>this.fetchTiUSDChartData())}buildOption(){this.option.series[0].data=this.chartData,this.option=(0,y.cloneDeep)(this.option)}calcPriceImpact(n,i){if(n>0&&i>0){const s=this.fund1/this.fund0;this.priceImpact=(100*Math.abs(s-n/i)/s).toFixed(2)+"%"}}onInputValueChange(n){try{this.inputValue=parseFloat(n.target.value)}catch(p){this.inputValue=0}const i=997*this.inputValue;this.outputValue=parseFloat((i*(this.isBuyingTiUSD?this.fund0:this.fund1)/(1e3*(this.isBuyingTiUSD?this.fund1:this.fund0)+i)).toFixed(4)),this.isBuyingTiUSD?this.calcPriceImpact(this.inputValue,this.outputValue):this.calcPriceImpact(this.outputValue,this.inputValue)}onOutputValueChange(n){try{this.outputValue=parseFloat(n.target.value)}catch(i){this.outputValue=0}this.inputValue=parseFloat((((this.isBuyingTiUSD?this.fund0:this.fund1)*(this.isBuyingTiUSD?this.fund1:this.fund0)*1e3/((this.isBuyingTiUSD?this.fund0:this.fund1)-this.outputValue)-1e3*(this.isBuyingTiUSD?this.fund1:this.fund0))/997).toFixed(4)),this.isBuyingTiUSD?this.calcPriceImpact(this.inputValue,this.outputValue):this.calcPriceImpact(this.outputValue,this.inputValue)}onChangeSwapType(){this.isBuyingTiUSD=!this.isBuyingTiUSD,this.inputValue=this.outputValue;const n=997*this.inputValue;this.outputValue=parseFloat((n*(this.isBuyingTiUSD?this.fund0:this.fund1)/(1e3*(this.isBuyingTiUSD?this.fund1:this.fund0)+n)).toFixed(4)),this.isBuyingTiUSD?this.calcPriceImpact(this.inputValue,this.outputValue):this.calcPriceImpact(this.outputValue,this.inputValue)}fetchOption(){return this.echartService.fetchOption("TiUSDPrice").then(n=>this.option=n)}fetchPoolInfo(){this.web3Service.invokeContract("MAMMSwapPair","getDepth",[]).then(n=>{this.fund0=n[0]/10**this.decimal0,this.fund1=n[1]/10**this.decimal1})}fetchMMFFund(){this.web3Service.invokeContract("MAMMSwapPair","getMMFFunds",[]).then(n=>{this.MMFfund=n[1]/10**this.decimal1})}fetchLastfund0(){this.web3Service.invokeContract("ReOrdersController","lastFund0",[]).then(n=>{this.lastFund0=n[0]/10**this.decimal0})}fetchLastfund1(){this.web3Service.invokeContract("ReOrdersController","lastFund1",[]).then(n=>{this.lastFund1=n[0]/10**this.decimal1})}fetchTiUSDChartData(){this.graphService.fetchMMFSwapPairHourData(f.wE.MAMMSwapPair).then(({data:n})=>{this.chartData=Array(720).fill(null);const i=(0,M.jn)().reverse();n.pair.pairHourData.forEach(r=>{const p=i.indexOf(1e3*r.hourStartTimestamp);-1!==p&&(this.chartData[p]=parseFloat(r.token0Price).toFixed(4))});let s=1;this.chartData.forEach((r,p)=>{null==r?this.chartData[p]=s:s=r}),this.buildOption()})}onSwap(){if(0!==this.outputValue)if(this.isBuyingTiUSD){const n=new(o())(1e4*this.inputValue).mul(new(o())("10").pow(new(o())(this.decimal1))).div(new(o())("10000"));this.web3Service.openApproveModal("USDC",n,"MAMMSwapPair",i=>{i&&this.web3Service.invokeContract("MAMMSwapPair","mint",[n.toString()]).then(s=>{})})}else{const n=new(o())(1e4*this.inputValue).mul(new(o())("10").pow(new(o())(this.decimal0))).div(new(o())("10000"));this.web3Service.openApproveModal("TiUSDToken",n,"MAMMSwapPair",i=>{i&&this.web3Service.invokeContract("MAMMSwapPair","redeem",[n.toString()]).then(s=>{})})}}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(l.jv),t.Y36(x.H7),t.Y36(f.Uc),t.Y36(F.uw),t.Y36(A.h),t.Y36(C.p),t.Y36(D.g))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-swap"]],decls:86,vars:30,consts:[[1,"swap-wrapper"],[1,"swap-card","mat-elevation-z4"],[2,"justify-self","start"],["appearance","outline",1,"swap-input"],["type","text","matInput","","type","number",2,"height","24px","font-size","24px",3,"value","change"],["matPrefix","",2,"padding-right","12px",3,"svgIcon"],["matSuffix","",2,"color","rgba(185, 185, 185, 0.7)","height","42px","font-size","18px"],[2,"justify-self","end"],["text","xxxxxxxxxxxxxxxxxxxxx"],["mat-icon-button","","color","primary",2,"justify-self","center",3,"click"],["matSuffix","",2,"color","rgba(120, 120, 120, 0.7)","height","42px","font-size","18px"],["mat-raised-button","","color","primary",1,"swap-btn",3,"disabled","click"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[2,"justify-self","center"],[2,"justify-self","end","grid-column-start","2","grid-column-end","4"],[1,"pool-chart",2,"width","100%","height","100%"],[2,"width","100%","height","100%",3,"option"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3),t.qZA(),t._UZ(4,"div"),t._UZ(5,"div"),t.TgZ(6,"mat-form-field",3),t.TgZ(7,"mat-label"),t._uU(8,"Input"),t.qZA(),t.TgZ(9,"input",4),t.NdJ("change",function(r){return i.onInputValueChange(r)}),t.qZA(),t._UZ(10,"mat-icon",5),t.TgZ(11,"div",6),t._uU(12),t.qZA(),t.qZA(),t.TgZ(13,"span",2),t._uU(14,"Token Value:"),t.qZA(),t._UZ(15,"div"),t.TgZ(16,"span",7),t._uU(17),t.ALo(18,"numberFormat"),t._UZ(19,"titi-tooltip",8),t.qZA(),t._UZ(20,"div"),t.TgZ(21,"button",9),t.NdJ("click",function(){return i.onChangeSwapType()}),t.TgZ(22,"mat-icon"),t._uU(23,"arrow_downward"),t.qZA(),t.qZA(),t._UZ(24,"div"),t.TgZ(25,"mat-form-field",3),t.TgZ(26,"mat-label"),t._uU(27,"Output"),t.qZA(),t.TgZ(28,"input",4),t.NdJ("change",function(r){return i.onOutputValueChange(r)}),t.qZA(),t._UZ(29,"mat-icon",5),t.TgZ(30,"div",10),t._uU(31),t.qZA(),t.qZA(),t.TgZ(32,"span",2),t._uU(33,"Price Impact:"),t.qZA(),t._UZ(34,"div"),t.TgZ(35,"span",7),t._uU(36),t._UZ(37,"titi-tooltip",8),t.qZA(),t.TgZ(38,"span",2),t._uU(39,"Swap Rewards:"),t.qZA(),t._UZ(40,"div"),t.TgZ(41,"span",7),t._uU(42,"0.00 TiTi ($0.00)"),t._UZ(43,"titi-tooltip",8),t.qZA(),t.TgZ(44,"button",11),t.NdJ("click",function(){return i.onSwap()}),t._uU(45,"Swap"),t.qZA(),t.qZA(),t.TgZ(46,"div",12),t.TgZ(47,"h2",13),t._uU(48,"USDC Pool Info"),t.qZA(),t._UZ(49,"mat-divider"),t.TgZ(50,"mat-chip-list",14),t.TgZ(51,"mat-chip"),t._uU(52,"Liquidity"),t.qZA(),t.qZA(),t._UZ(53,"mat-divider"),t.TgZ(54,"span",2),t._uU(55,"TiUSD:"),t.qZA(),t.TgZ(56,"span",15),t._uU(57),t.ALo(58,"numberFormat"),t.qZA(),t.TgZ(59,"span",2),t._uU(60,"USDC:"),t.qZA(),t.TgZ(61,"span",15),t._uU(62),t.ALo(63,"numberFormat"),t.qZA(),t._UZ(64,"mat-divider"),t.TgZ(65,"mat-chip-list",14),t.TgZ(66,"mat-chip"),t._uU(67,"Composition"),t.qZA(),t.qZA(),t._UZ(68,"mat-divider"),t.TgZ(69,"span",2),t._uU(70,"PRV"),t.qZA(),t.TgZ(71,"span",15),t._uU(72),t.ALo(73,"numberFormat"),t.qZA(),t.TgZ(74,"span",2),t._uU(75,"MMF"),t.qZA(),t.TgZ(76,"span",15),t._uU(77),t.ALo(78,"numberFormat"),t.qZA(),t._UZ(79,"mat-divider"),t.TgZ(80,"mat-chip-list",14),t.TgZ(81,"mat-chip"),t._uU(82,"Price"),t.qZA(),t.qZA(),t._UZ(83,"mat-divider"),t.TgZ(84,"div",16),t._UZ(85,"titi-chart-wrapper",17),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(3),t.hij(" ",i.isBuyingTiUSD?i.currentSwapPair.token1+" - "+i.currentSwapPair.token0:i.currentSwapPair.token0+" - "+i.currentSwapPair.token1," "),t.xp6(6),t.Q6J("value",i.inputValue),t.xp6(1),t.Q6J("svgIcon",i.isBuyingTiUSD?i.currentSwapPair.token1:i.currentSwapPair.token0),t.xp6(2),t.hij(" ",i.isBuyingTiUSD?i.currentSwapPair.token1:i.currentSwapPair.token0,""),t.xp6(5),t.hij("$",t.xi3(18,15,i.fund1/i.fund0||0,4),""),t.xp6(11),t.Q6J("value",i.outputValue),t.xp6(1),t.Q6J("svgIcon",i.isBuyingTiUSD?i.currentSwapPair.token0:i.currentSwapPair.token1),t.xp6(2),t.hij(" ",i.isBuyingTiUSD?i.currentSwapPair.token0:i.currentSwapPair.token1,""),t.xp6(5),t.Oqu(i.priceImpact),t.xp6(8),t.Q6J("disabled",!i.outputValue||i.outputValue<=0),t.xp6(13),t.Oqu(t.xi3(58,18,i.fund0,4)),t.xp6(5),t.Oqu(t.xi3(63,21,i.fund1,4)),t.xp6(10),t.hij("",t.xi3(73,24,i.prv,4)," USDC"),t.xp6(5),t.hij("",t.xi3(78,27,i.MMFfund,4)," USDC"),t.xp6(8),t.Q6J("option",i.option))},directives:[h.KE,h.hX,m.Nt,l.Hw,h.qo,h.R9,P.Q,v.lW,S.d,c.qn,c.HS,V.o],pipes:[I.p],styles:[".swap-wrapper[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:16fr 8fr 1fr;grid-column-gap:48px;column-gap:48px}.swap-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;padding:24px 48px;display:grid;grid-template-columns:1fr 1fr 1fr;grid-row-gap:24px;row-gap:24px;align-items:center}.swap-input[_ngcontent-%COMP%], .swap-btn[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4}.pool-info-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;padding:12px 48px;display:grid;grid-template-columns:1fr 1fr 1fr;grid-row-gap:24px;row-gap:24px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4;justify-self:center}.pool-chart[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4;justify-self:center;width:100%;height:100%}@media screen and (max-width: 1024px){.swap-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;margin:0;display:grid;grid-template-columns:1fr;grid-row-gap:12px;row-gap:12px}.swap-card[_ngcontent-%COMP%]{padding:24px 12px;width:100%}}"]}),e})();const B='<svg t="1640244631175" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2048" width="24" height="24"><path d="M513.896296 986.074074c263.888593 0 477.866667-213.978074 477.866667-477.866667s-213.978074-477.866667-477.866667-477.866666-477.866667 213.978074-477.866666 477.866666 213.978074 477.866667 477.866666 477.866667z" fill="#1296db" p-id="2049"></path><path d="M644.892444 584.210963c0-69.783704-42.477037-93.297778-124.54874-104.523852-60.529778-8.798815-72.286815-22.983111-72.286815-51.275852 0-26.851556 20.48-45.89037 60.074667-45.89037 35.802074 0 56.357926 12.515556 64.853333 41.263407 1.896296 6.447407 7.661037 10.998519 14.336 10.998519h31.402667c8.722963 0 15.54963-8.040296 13.729185-16.611556-9.936593-45.511111-40.580741-72.817778-88.670815-81.389037v-47.559111c0-8.267852-6.674963-14.942815-14.942815-14.942815h-29.88563c-8.267852 0-14.942815 6.674963-14.942814 14.942815v46.26963c-59.240296 8.419556-97.46963 47.786667-97.46963 98.379852 0 65.460148 39.518815 90.794667 123.031704 102.02074 56.661333 9.253926 72.741926 21.466074 72.741926 53.703111s-27.382519 53.703111-65.91526 53.703112c-52.110222 0-69.328593-22.831407-75.624296-52.337778-1.517037-6.97837-7.509333-12.136296-14.639407-12.136297h-34.057482c-8.571259 0-15.322074 7.736889-13.805037 16.156445 8.647111 49.682963 40.580741 86.167704 105.737482 95.04237v47.179852c0 8.267852 6.674963 14.942815 14.942814 14.942815h29.88563c8.267852 0 14.942815-6.674963 14.942815-14.942815v-47.179852c61.667556-9.784889 101.110519-52.717037 101.110518-105.813333z" fill="#FFFFFF" p-id="2050"></path><path d="M411.496296 793.713778c-114.384593-41.870222-196.228741-151.855407-196.22874-280.576 0-128.720593 81.844148-238.629926 196.22874-280.576 7.130074-2.578963 12.818963-11.226074 12.818963-18.811259v-27.83763c0-11.301926-8.798815-17.673481-19.569778-14.260148C260.171852 217.92237 155.496296 353.317926 155.496296 513.21363c0 159.895704 104.675556 295.291259 249.249185 341.485037 10.770963 3.413333 19.569778-2.958222 19.569778-14.260148v-27.83763c0-7.661037-5.688889-16.232296-12.818963-18.887111zM623.122963 171.728593c-10.770963-3.413333-19.569778 2.958222-19.569778 14.260148v27.837629c0 7.585185 5.688889 16.232296 12.818963 18.81126 114.384593 41.870222 196.228741 151.855407 196.228741 280.576 0 128.720593-81.844148 238.629926-196.228741 280.576-7.812741 2.88237-12.818963 10.543407-12.818963 18.811259v27.83763c0 11.301926 8.798815 17.673481 19.569778 14.260148 144.57363-46.193778 249.249185-181.589333 249.249185-341.485037S767.620741 217.92237 623.122963 171.728593z" fill="#FFFFFF" p-id="2051"></path></svg>',b='\n<svg version="1.1" id="\u56fe\u5c42_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 700 700" style="enable-background:new 0 0 700 700;" xml:space="preserve">\n<style type="text/css">\n\t.st0{fill:none;}\n\t.st1{fill:#3FE4CF;}\n</style>\n<g>\n\t<g>\n\t\t<circle class="st0" cx="350" cy="350" r="350"/>\n\t\t<g>\n\t\t\t<path class="st1" d="M350,700C157,700,0,543,0,350S157,0,350,0s350,157,350,350S543,700,350,700z M350,25.9\n\t\t\t\tC171.3,25.9,25.9,171.3,25.9,350S171.3,674.1,350,674.1S674.1,528.7,674.1,350S528.7,25.9,350,25.9z"/>\n\t\t</g>\n\t</g>\n\t<g>\n\t\t<path class="st1" d="M424.6,322.2h-0.2v55.4h0.2c58.2,0,87.8,21.4,87.8,63.7c0,41.4-29.5,62.4-87.8,62.4l-30.8,0V227.4h-87.6v95\n\t\t\tl-30.8,0c-58.2,0-87.8-21-87.8-62.4c0-42.3,29.5-63.7,87.8-63.7h0.2V141h-0.2C186.9,141,134,185.5,134,260\n\t\t\tc0,73.8,52.9,117.8,141.4,117.8l30.8,0v125.8l-126.7,0V559l245.2,0c88.5,0,141.4-44,141.4-117.8\n\t\t\tC566,366.7,513.1,322.2,424.6,322.2z"/>\n\t\t<rect x="306.2" y="141" class="st1" width="214.4" height="55.4"/>\n\t</g>\n</g>\n</svg>\n',j=[{path:"",component:O}];let q=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[g.Bz.forChild(j)],g.Bz]}),e})();var z=a(45922),L=a(87841);let k=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[Z.ez,U.u5,q,m.c,v.ot,l.Ps,S.t,c.Hi,z.F,L.m]]}),e})()}}]);