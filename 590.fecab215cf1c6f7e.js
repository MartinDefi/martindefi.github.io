"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[590],{40590:(ct,f,o)=>{o.r(f),o.d(f,{MyAccountModule:()=>rt});var S=o(69808),g=o(91083),w=o(11730),D=o(98538),c=o.n(D),t=o(5e3),k=o(94602),R=o(32681),b=o(31657),P=o(53405),_=o(92134),s=o(32075),x=o(75303);function U(e,a){1&e&&(t.TgZ(0,"th",22),t._uU(1,"Act."),t.qZA())}function Z(e,a){if(1&e&&(t.TgZ(0,"td",23),t._uU(1),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.Oqu(i.act)}}function O(e,a){1&e&&(t.TgZ(0,"th",24),t._uU(1,"Your Staked Value"),t.qZA())}function L(e,a){if(1&e&&(t.TgZ(0,"td",25),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.hij("$ ",t.xi3(2,1,i.staked,4),"")}}function B(e,a){1&e&&(t.TgZ(0,"th",24),t._uU(1,"Claimable TiTi Rewards"),t.qZA())}function Y(e,a){1&e&&t._UZ(0,"titi-tooltip",27)}function N(e,a){if(1&e&&(t.TgZ(0,"td",25),t._uU(1),t.ALo(2,"numberFormat"),t.YNc(3,Y,1,0,"titi-tooltip",26),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.hij("",t.xi3(2,2,i.reward,4)," "),t.xp6(2),t.Q6J("ngIf","TiTi Staking"===i.act)}}function F(e,a){1&e&&(t.TgZ(0,"th",24),t._uU(1,"Dynamic APY"),t.qZA())}function q(e,a){if(1&e&&(t.TgZ(0,"td",25),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,i.apy,4),"%")}}function Q(e,a){1&e&&t._UZ(0,"tr",28)}function z(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"tr",29),t.NdJ("click",function(){const l=t.CHM(i).$implicit;return t.oxw().onRowClick(l)}),t.qZA()}}function E(e,a){1&e&&(t.TgZ(0,"th",22),t._uU(1,"Act."),t.qZA())}function J(e,a){if(1&e&&(t.TgZ(0,"td",23),t._uU(1),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.Oqu(i.act)}}function $(e,a){1&e&&(t.TgZ(0,"th",24),t._uU(1,"Total Rewards"),t.qZA())}function H(e,a){if(1&e&&(t.TgZ(0,"td",25),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,i.total,4)," TiTi")}}function j(e,a){1&e&&(t.TgZ(0,"th",24),t._uU(1,"Distributed Rewards"),t.qZA())}function V(e,a){if(1&e&&(t.TgZ(0,"td",25),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,i.personal,4)," TiTi")}}function I(e,a){1&e&&(t.TgZ(0,"th",24),t._uU(1,"Expected Daily Rewards"),t.qZA())}function W(e,a){if(1&e&&(t.TgZ(0,"td",25),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&e){const i=a.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,i.rate,4)," TiTi/Day")}}function G(e,a){1&e&&t._UZ(0,"tr",28)}function X(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"tr",29),t.NdJ("click",function(){const l=t.CHM(i).$implicit;return t.oxw().onRowClick(l)}),t.qZA()}}let K=(()=>{class e{constructor(i,n,r,l,d,u){this.router=i,this.web3Service=n,this.accountService=r,this.use2earnService=l,this.refreshService=d,this.graphService=u,this.displayedColumns1=["act","staked","reward","apy"],this.displayedColumns2=["act","total","personal","rate"],this.dataSource1=[],this.dataSource2=[],this.buyTiUSDReward=y,this.buyTiUSDPersonalReward=0,this.buyTiUSDRewardRate=y/p,this.buyTiUSDPersonalRewardRate=0,this.holdTiUSDReward=v,this.holdTiUSDPersonalReward=0,this.holdTiUSDRewardRate=v/p,this.holdTiUSDPersonalRewardRate=0,this.buyTiTiReward=A,this.buyTiTiPersonalReward=0,this.buyTiTiRewardRate=A/p,this.buyTiTiPersonalRewardRate=0,this.totalClaimableRewards=0,this.distributedTiTiRewards=0,this.usdcMmfStaked=0,this.usdcMmfReward=0,this.usdcMmfApy=0,this.lpMiningStaked=0,this.lpMiningReward=0,this.lpMiningApy=0,this.LPTokenPrice=0,this.titiStakingStaked=0,this.titiStakingReward=0,this.titiStakingApy=0,this.titiPrice=0,this.clickedRows=new Set,this.TiUSDBalance=0,this.TiTiBalance=0,this.mmfDecimal1=6,this.lpminingDecimal1=18}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){this.fetchBalanceOfTiUSD(),this.fetchBalanceOfTiTi(),Promise.all([this.use2earnService.fetchUserData(),this.fetchMMFData().then(()=>this.fetchLpMiningData()),this.fetchTiTiStakingData()]).then(()=>this.buildDataSource())}fetchBalanceOfStakedLPToken(){return this.accountService.getCurrentAccountAsyn().then(i=>this.web3Service.invokeContract("MMFLPStakingPool","balanceOf",[i]).then(n=>this.web3Service.invokeContract("MarketMakerFund","getShareValue",[n[0]])))}fetchMMFData(){return this.accountService.getCurrentAccountAsyn().then(i=>Promise.all([this.fetchBalanceOfStakedLPToken(),this.web3Service.invokeContract("MMFLPStakingPool","rewardRate",[]),this.web3Service.invokeContract("MMFLPStakingPool","earned",[i]),this.web3Service.invokeContract("UniswapV2Pair","getReserves",[]),this.graphService.fetchTodayMMFRewardData(w.wE.MAMMSwapPair),this.web3Service.invokeContract("MMFLPStakingPool","startTime",[]),this.web3Service.invokeContract("MMFLPStakingPool","periodFinish",[])]).then(n=>{const r=(new Date).getTime()/1e3;this.usdcMmfStaked=n[0][0]/10**this.mmfDecimal1;const l=r>n[6][0]||r<n[5][0]?0:n[1][0];this.usdcMmfReward=n[2][0]/10**18;const u=n[4].data.pair.fund0,h=n[4].data.pair.fund1,m=n[4].data.pairDailyData?n[4].data.pairDailyData.mmfFund1:0;this.usdcMmfApy=0==m?0:365*(n[3][1]/n[3][0]*(h*10**12/u)*l*3600*24/10**18+(n[4].data.mmfrewardDailyData?n[4].data.mmfrewardDailyData.mmfReward:0)/10**this.mmfDecimal1)*100/(m/10**this.mmfDecimal1),this.titiPrice=n[3][1]/n[3][0]*(h*10**12/u)}))}fetchLpMiningData(){return this.accountService.getCurrentAccountAsyn().then(i=>Promise.all([this.web3Service.invokeContract("LPStakingPool","balanceOf",[i]),this.web3Service.invokeContract("LPStakingPool","earned",[i]),this.web3Service.invokeContract("LPStakingPool","rewardRate",[]),this.web3Service.invokeContract("UniswapV2Pair","getReserves",[]),this.web3Service.invokeContract("LPStakingPool","totalSupply",[]),this.web3Service.invokeContract("LPStakingPool","startTime",[]),this.web3Service.invokeContract("LPStakingPool","periodFinish",[]),this.web3Service.invokeContract("MAMMSwapPair","getDepth",[]),this.web3Service.invokeContract("UniswapV2Pair","totalSupply",[])]).then(n=>{const r=(new Date).getTime()/1e3;this.lpMiningStaked=n[0][0]/10**this.lpminingDecimal1,this.lpMiningReward=n[1][0]/10**18;const l=r>n[6][0]||r<n[5][0]?0:n[2][0];this.LPTokenPrice=n[8][0]>0?2*n[3][1]*(n[7][1]/10**6/(n[7][0]/10**18))/n[8][0]:0,this.lpMiningApy=1*n[4][0]>0?this.titiPrice*l*3600*24*365*100/(n[4][0]*this.LPTokenPrice):0}))}fetchTiTiStakingData(){return this.accountService.getCurrentAccountAsyn().then(i=>Promise.all([this.web3Service.invokeContract("TiTiStaking","getStakeValue",[i]),this.web3Service.invokeContract("TiTiStaking","users",[i]),this.web3Service.invokeContract("TiTiStaking","WITHDRAW_DURATION",[]),this.web3Service.invokeContract("TiTiStaking","UNBONDING_DURATION",[]),this.graphService.fetchTiTiStakingDailyData(),this.web3Service.invokeContract("TiTiBackendV1","epochNum",[])]).then(([n,r,l,d,u,h])=>{const m=new(c())(r.share),C=new(c())(r.unbondShare);let M=0;1e3*r.unbondTime+1e3*d[0]<=(new Date).getTime()?this.titiStakingReward=m.isZero()?0:new(c())(n[0]/10**18).mul(C).div(m).toNumber():M=m.isZero()?0:new(c())(n[0]/10**18).mul(C).div(m).toNumber(),this.titiStakingStaked=n[0]/10**18-M-this.titiStakingReward,this.titiStakingApy=u.data.tiTiStakingEpochDailyDatas[0]&&u.data.tiTiStakingEpochDailyDatas[0].epoch.id==h[0]?100*u.data.tiTiStakingEpochDailyDatas[0].apy:0}))}fetchBalanceOfTiUSD(){this.accountService.getCurrentAccountAsyn().then(i=>this.web3Service.invokeContract("TiUSD","balanceOf",[i]).then(n=>{this.TiUSDBalance=n[0]/10**18}))}fetchBalanceOfTiTi(){this.accountService.getCurrentAccountAsyn().then(i=>this.web3Service.invokeContract("TiTiToken","balanceOf",[i]).then(n=>{this.TiTiBalance=n[0]/10**18}))}rewardPerToken(i){if(0===Number.parseInt(i.totalSupply))return new(c())(i.rewardPerTokenStored);const n=new(c())(this.lastTimeRewardApplicable()-1*i.lastUpdateTime).mul(new(c())(this.holdTiUSDRewardRate).mul(new(c())("1000000000000000000"))).mul(new(c())("1000000000000000000")).div(new(c())(i.totalSupply).mul(new(c())(86400)));return new(c())(i.rewardPerTokenStored).add(n)}lastTimeRewardApplicable(){let i;const n=(new Date).getTime();return i=n<T?T:n<T+24*p*3600*1e3?n:T+24*p*3600*1e3,i/1e3}buildDataSource(){this.dataSource1=[{act:"USDC-MMF",staked:this.usdcMmfStaked,reward:this.usdcMmfReward,apy:this.usdcMmfApy,url:"/mmf"},{act:"LP Mining",staked:this.lpMiningStaked*this.LPTokenPrice,reward:this.lpMiningReward,apy:this.lpMiningApy,url:"/lpmining"},{act:"TiTi Staking",staked:this.titiStakingStaked*this.titiPrice,reward:this.titiStakingReward,apy:this.titiStakingApy,url:"/titiStaking"}],this.dataSource2=[{act:"Buy TiUSD in MAMM",total:this.use2earnService.buyTiUSDReward,personal:this.use2earnService.buyTiUSDPersonalReward-this.use2earnService.buyTiUSDPersonalRewardRate>0?this.use2earnService.buyTiUSDPersonalReward-this.use2earnService.buyTiUSDPersonalRewardRate:0,rate:this.use2earnService.buyTiUSDPersonalRewardRate,url:"/use2earn/activity/buyTiUSD"},{act:"TiUSD Holder",total:this.use2earnService.holdTiUSDReward,personal:this.use2earnService.holdTiUSDPersonalReward,rate:this.use2earnService.holdTiUSDPersonalRewardRate,url:"/use2earn/activity/holdTiUSD"},{act:"Buy TiTi in Uniswap",total:this.use2earnService.buyTiTiReward,personal:this.use2earnService.buyTiTiPersonalReward-this.use2earnService.buyTiTiPersonalRewardRate,rate:this.use2earnService.buyTiTiPersonalRewardRate,url:"/use2earn/activity/buyTiTi"}]}onRowClick(i){this.router.navigateByUrl(i.url)}}return e.\u0275fac=function(i){return new(i||e)(t.Y36(g.F0),t.Y36(w.Uc),t.Y36(k.B),t.Y36(R.Q),t.Y36(b.g),t.Y36(P.h))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-my-account"]],decls:55,vars:14,consts:[[1,"my-account-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],[1,"value"],["text","Coming Soon ~"],[1,"mat-elevation-z4","farm-table-wrapper"],["mat-table","",1,"farm-table",3,"dataSource"],["matColumnDef","act"],["mat-header-cell","","style","width:19%",4,"matHeaderCellDef"],["mat-cell","","style","width:19%",4,"matCellDef"],["matColumnDef","staked"],["mat-header-cell","","style","width:27%",4,"matHeaderCellDef"],["mat-cell","","style","width:27%",4,"matCellDef"],["matColumnDef","reward"],["matColumnDef","apy"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],[1,"mat-elevation-z4","use2earn-table-wrapper"],["mat-table","",1,"use2earn-table",3,"dataSource"],["matColumnDef","total"],["matColumnDef","personal"],["matColumnDef","rate"],["mat-header-cell","",2,"width","19%"],["mat-cell","",2,"width","19%"],["mat-header-cell","",2,"width","27%"],["mat-cell","",2,"width","27%"],["text","Your unlocked claimable TiTi in TiTi-Staking",4,"ngIf"],["text","Your unlocked claimable TiTi in TiTi-Staking"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"TiUSD Balance"),t.qZA(),t.TgZ(4,"span",3),t._uU(5),t.ALo(6,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(7,"div",1),t.TgZ(8,"h2",2),t._uU(9,"TiTi Balance"),t.qZA(),t.TgZ(10,"span",3),t._uU(11),t.ALo(12,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(13,"div",1),t.TgZ(14,"h2",2),t._uU(15,"Your Account Level"),t.qZA(),t.TgZ(16,"span",3),t._uU(17,"Lv. - - "),t._UZ(18,"titi-tooltip",4),t.qZA(),t.qZA(),t.TgZ(19,"div",5),t.TgZ(20,"h2"),t._uU(21,"Farm List"),t.qZA(),t.TgZ(22,"table",6),t.ynx(23,7),t.YNc(24,U,2,0,"th",8),t.YNc(25,Z,2,1,"td",9),t.BQk(),t.ynx(26,10),t.YNc(27,O,2,0,"th",11),t.YNc(28,L,3,4,"td",12),t.BQk(),t.ynx(29,13),t.YNc(30,B,2,0,"th",11),t.YNc(31,N,4,5,"td",12),t.BQk(),t.ynx(32,14),t.YNc(33,F,2,0,"th",11),t.YNc(34,q,3,4,"td",12),t.BQk(),t.YNc(35,Q,1,0,"tr",15),t.YNc(36,z,1,0,"tr",16),t.qZA(),t.qZA(),t.TgZ(37,"div",17),t.TgZ(38,"h2"),t._uU(39,"Use-To-Earn List"),t.qZA(),t.TgZ(40,"table",18),t.ynx(41,7),t.YNc(42,E,2,0,"th",8),t.YNc(43,J,2,1,"td",9),t.BQk(),t.ynx(44,19),t.YNc(45,$,2,0,"th",11),t.YNc(46,H,3,4,"td",12),t.BQk(),t.ynx(47,20),t.YNc(48,j,2,0,"th",11),t.YNc(49,V,3,4,"td",12),t.BQk(),t.ynx(50,21),t.YNc(51,I,2,0,"th",11),t.YNc(52,W,3,4,"td",12),t.BQk(),t.YNc(53,G,1,0,"tr",15),t.YNc(54,X,1,0,"tr",16),t.qZA(),t.qZA(),t.qZA()),2&i&&(t.xp6(5),t.Oqu(t.xi3(6,8,n.TiUSDBalance,4)),t.xp6(6),t.Oqu(t.xi3(12,11,n.TiTiBalance,4)),t.xp6(11),t.Q6J("dataSource",n.dataSource1),t.xp6(13),t.Q6J("matHeaderRowDef",n.displayedColumns1),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns1),t.xp6(4),t.Q6J("dataSource",n.dataSource2),t.xp6(13),t.Q6J("matHeaderRowDef",n.displayedColumns2),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns2))},directives:[_.Q,s.BZ,s.w1,s.fO,s.Dz,s.as,s.nj,s.ge,s.ev,S.O5,s.XQ,s.Gk],pipes:[x.p],styles:[".mat-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid transparent;border-top:1px solid transparent;cursor:pointer}.mat-row[_ngcontent-%COMP%]:hover   .mat-cell[_ngcontent-%COMP%]{border-color:#1de9b6}.my-account-wrapper[_ngcontent-%COMP%]{padding:12px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr 1fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:80px;padding:18px;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 3;margin-left:48px;margin-bottom:20px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 2;margin-left:48px;align-self:end;font-size:18px;line-height:18px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.use2earn-table-wrapper[_ngcontent-%COMP%]{grid-column-start:span 6;padding:12px;display:flex;align-items:center;flex-direction:column;min-height:240px}.use2earn-table[_ngcontent-%COMP%]{width:100%;background:transparent}.farm-table-wrapper[_ngcontent-%COMP%]{grid-column-start:span 6;padding:12px;display:flex;align-items:center;flex-direction:column;min-height:240px}.farm-table[_ngcontent-%COMP%]{width:100%;background:transparent}@media screen and (max-width: 1024px){.my-account-wrapper[_ngcontent-%COMP%]{grid-row-gap:12px;row-gap:12px;width:100%;padding:12px}.biz-info-card[_ngcontent-%COMP%]{grid-column-start:span 6}}"]}),e})();const T=16799184e5,p=21,y=15e4,v=15e4,A=15e4,tt=[{path:"",component:K}];let et=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[g.Bz.forChild(tt)],g.Bz]}),e})();var it=o(47423),nt=o(87238),at=o(63874),ot=o(87841);let rt=(()=>{class e{}return e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[S.ez,et,s.p0,it.ot,nt.AV,at.Ps,ot.m]]}),e})()}}]);