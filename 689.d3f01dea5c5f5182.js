"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[689],{43689:(ht,C,a)=>{a.r(C),a.d(C,{Use2earnModule:()=>mt});var v=a(69808),T=a(91083),y=a(98538),x=a.n(y),d=a(32935),g=a(54898);class m{constructor(e){this.elements=[...e],this.elements.sort(Buffer.compare),this.elements=m.bufDedup(this.elements),this.bufferElementPositionIndex=this.elements.reduce((n,i,o)=>(n[(0,g.bufferToHex)(i)]=o,n),{}),this.layers=this.getLayers(this.elements)}getLayers(e){if(0===e.length)throw new Error("empty tree");const n=[];for(n.push(e);n[n.length-1].length>1;)n.push(this.getNextLayer(n[n.length-1]));return n}getNextLayer(e){return e.reduce((n,i,o,s)=>(o%2==0&&n.push(m.combinedHash(i,s[o+1])),n),[])}static combinedHash(e,n){return e?n?(0,g.keccak256)(m.sortAndConcat(e,n)):e:n}getRoot(){return this.layers[this.layers.length-1][0]}getHexRoot(){return(0,g.bufferToHex)(this.getRoot())}getProof(e){let n=this.bufferElementPositionIndex[(0,g.bufferToHex)(e)];if("number"!=typeof n)throw new Error("Element does not exist in Merkle tree");return this.layers.reduce((i,o)=>{const s=m.getPairElement(n,o);return s&&i.push(s),n=Math.floor(n/2),i},[])}getHexProof(e){const n=this.getProof(e);return m.bufArrToHexArr(n)}static getPairElement(e,n){const i=e%2==0?e+1:e-1;return i<n.length?n[i]:null}static bufDedup(e){return e.filter((n,i)=>0===i||!e[i-1].equals(n))}static bufArrToHexArr(e){if(e.some(n=>!Buffer.isBuffer(n)))throw new Error("Array is not an array of buffers");return e.map(n=>"0x"+n.toString("hex"))}static sortAndConcat(...e){return Buffer.concat([...e].sort(Buffer.compare))}}var l=a(10499),Z=a(92547),A=a(63544),S=a(88666);const D=new RegExp("^bytes([0-9]+)$"),P=new RegExp("^(u?int)([0-9]*)$"),M=new RegExp("^(.*)\\[([0-9]*)\\]$"),h=new S.Yd("solidity/5.6.0");function b(r,e,n){switch(r){case"address":return n?(0,l.Bu)(e,32):(0,l.lE)(e);case"string":return(0,A.Y0)(e);case"bytes":return(0,l.lE)(e);case"bool":return e=e?"0x01":"0x00",n?(0,l.Bu)(e,32):(0,l.lE)(e)}let i=r.match(P);if(i){let o=parseInt(i[2]||"256");return(i[2]&&String(o)!==i[2]||o%8!=0||0===o||o>256)&&h.throwArgumentError("invalid number type","type",r),n&&(o=256),e=d.O$.from(e).toTwos(o),(0,l.Bu)(e,o/8)}if(i=r.match(D),i){const o=parseInt(i[1]);return(String(o)!==i[1]||0===o||o>32)&&h.throwArgumentError("invalid bytes type","type",r),(0,l.lE)(e).byteLength!==o&&h.throwArgumentError(`invalid value for ${r}`,"value",e),n?(0,l.lE)((e+"0000000000000000000000000000000000000000000000000000000000000000").substring(0,66)):e}if(i=r.match(M),i&&Array.isArray(e)){const o=i[1];parseInt(i[2]||String(e.length))!=e.length&&h.throwArgumentError(`invalid array length for ${r}`,"value",e);const c=[];return e.forEach(function(p){c.push(b(o,p,!0))}),(0,l.zo)(c)}return h.throwArgumentError("invalid type","type",r)}function w(r,e){r.length!=e.length&&h.throwArgumentError("wrong number of values; expected ${ types.length }","values",e);const n=[];return r.forEach(function(i,o){n.push(b(i,e[o]))}),(0,l.Dv)((0,l.zo)(n))}class f{constructor(e){this.tree=new m(e.map(({account:n,amount:i})=>f.toNode(n,i)))}static verifyProof(e,n,i,o){let s=f.toNode(e,n);for(const c of i)s=m.combinedHash(s,c);return s.equals(o)}static toNode(e,n){return Buffer.from(function(r,e){return(0,Z.w)(w(["address","uint256"],e))}(0,[e,n]).substr(2),"hex")}getHexRoot(){return this.tree.getHexRoot()}getProof(e,n){return this.tree.getHexProof(f.toNode(e,n))}}var N=a(28321),t=a(5e3),E=a(32681),Y=a(31657),B=a(48966),$=a(11730),H=a(94602),L=a(92134),U=a(47423),u=a(32075),Q=a(75303);function z(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Act."),t.qZA())}function F(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.Oqu(n.act)}}function j(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Total Rewards"),t.qZA())}function q(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.total,2)," TiTi")}}function J(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Pending Rewards"),t.qZA())}function k(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.personal,2)," TiTi")}}function I(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Expected Daily Rewards"),t.qZA())}function X(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.rate,2)," TiTi/Day")}}function G(r,e){1&r&&t._UZ(0,"tr",24)}function W(r,e){if(1&r){const n=t.EpF();t.TgZ(0,"tr",25),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw().onRowClick(s)}),t.qZA()}}function K(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Act."),t.qZA())}function V(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.Oqu(n.act)}}function tt(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Total Rewards"),t.qZA())}function et(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.total,2)," TiTi")}}function nt(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Pending Rewards"),t.qZA())}function rt(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.personal,2)," TiTi")}}function it(r,e){1&r&&(t.TgZ(0,"th",22),t._uU(1,"Expected Daily Rewards"),t.qZA())}function ot(r,e){if(1&r&&(t.TgZ(0,"td",23),t._uU(1),t.ALo(2,"numberFormat"),t.qZA()),2&r){const n=e.$implicit;t.xp6(1),t.hij("",t.xi3(2,1,n.rate,2)," TiTi/Day")}}function at(r,e){1&r&&t._UZ(0,"tr",24)}function st(r,e){if(1&r){const n=t.EpF();t.TgZ(0,"tr",25),t.NdJ("click",function(){const s=t.CHM(n).$implicit;return t.oxw().onRowClick(s)}),t.qZA()}}const ct=[{path:"",component:(()=>{class r{constructor(n,i,o,s,c,p){this.router=n,this.use2earnService=i,this.refreshService=o,this.dialog=s,this.web3Service=c,this.accountService=p,this.displayedColumns=["act","total","personal","rate"],this.dataSource1=[],this.dataSource2=[],this.treeData=[],this.clickedRows=new Set}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData()),this.fetchTreeData()}ngOnDestroy(){this.unregister()}initData(){this.fetchUserData().then(()=>this.buildDataSource())}fetchUserData(){return this.use2earnService.fetchUserData()}fetchTreeData(){Promise.all([fetch("/assets/use2earn/treeData.json").then(n=>n.text()).then(n=>JSON.parse(n)),this.accountService.getCurrentAccountAsyn()]).then(([n,i])=>{this.treeData=n,this.treeData.forEach(o=>{o.account.toLowerCase()===i.toLowerCase()&&(this.use2earnService.totalClaimableRewards=new(x())((0,N.uM)(o.amount)).div(new(x())("10").pow(new(x())("18"))).toNumber()/1e4)}),this.balanceTree=new f(this.treeData.map(o=>({account:o.account,amount:d.O$.from(o.amount)})))})}buildDataSource(){this.dataSource1=[{act:"Buy TiUSD in MAMM",total:this.use2earnService.buyTiUSDReward,personal:this.use2earnService.buyTiUSDPersonalReward,rate:this.use2earnService.buyTiUSDPersonalRewardRate,url:"/use2earn/activity/buyTiUSD"},{act:"TiUSD Holder",total:this.use2earnService.holdTiUSDReward,personal:this.use2earnService.holdTiUSDPersonalReward,rate:this.use2earnService.holdTiUSDPersonalRewardRate,url:"/use2earn/activity/holdTiUSD"}],this.dataSource2=[{act:"Buy TiTi in Uniswap",total:this.use2earnService.buyTiTiReward,personal:this.use2earnService.buyTiTiPersonalReward,rate:this.use2earnService.buyTiTiPersonalRewardRate,url:"/use2earn/activity/buyTiTi"}]}onRowClick(n){this.router.navigateByUrl(n.url)}onClaim(){a.e(797).then(a.bind(a,51797)).then(({TitiStakingModalComponent:n})=>{this.dialog.open(n).afterClosed().subscribe(o=>this.accountService.getCurrentAccountAsyn().then(s=>{var c;const p=d.O$.from(1e4*this.use2earnService.totalClaimableRewards).mul(d.O$.from("10").pow(d.O$.from("18"))).div(d.O$.from("10000")),dt=null===(c=this.balanceTree)||void 0===c?void 0:c.getProof(s.toLowerCase(),p);this.web3Service.invokeContract("TiTiMerkleDistributor",o?"claimAndStake":"claim",[p.toString(),dt])}))})}}return r.\u0275fac=function(n){return new(n||r)(t.Y36(T.F0),t.Y36(E.Q),t.Y36(Y.g),t.Y36(B.uw),t.Y36($.Uc),t.Y36(H.B))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-use2earn"]],decls:60,vars:19,consts:[[1,"use2earn-wrapper"],[1,"mat-elevation-z4","biz-info-card"],[1,"title"],["text","Accumulated TiTi Rewards distributed to use-to-earn behaviors."],[1,"value"],["text","Accural of unclaimable rewards in your account until the distribution is triggered."],["text","Accural of claimable rewards in your account at anytime."],["mat-raised-button","","color","primary",1,"action-btn",3,"disabled","click"],[1,"mat-elevation-z4","activity-table-wrapper"],["mat-table","",1,"activity-table",3,"dataSource"],["matColumnDef","act"],["mat-header-cell","","class"," left-align",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","total"],["mat-header-cell","","class"," right-align",4,"matHeaderCellDef"],["mat-cell","","class"," right-align",4,"matCellDef"],["matColumnDef","personal"],["matColumnDef","rate"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"left-align"],["mat-cell",""],["mat-header-cell","",1,"right-align"],["mat-cell","",1,"right-align"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3,"Distributed TiTi Rewards"),t._UZ(4,"titi-tooltip",3),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.ALo(7,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(8,"div",1),t.TgZ(9,"h2",2),t._uU(10,"Your Pending Rewards"),t._UZ(11,"titi-tooltip",5),t.qZA(),t.TgZ(12,"span",4),t._uU(13),t.ALo(14,"numberFormat"),t.qZA(),t.qZA(),t.TgZ(15,"div",1),t.TgZ(16,"h2",2),t._uU(17,"Your Claimable Rewards"),t._UZ(18,"titi-tooltip",6),t.qZA(),t.TgZ(19,"span",4),t._uU(20),t.ALo(21,"numberFormat"),t.qZA(),t.TgZ(22,"button",7),t.NdJ("click",function(){return i.onClaim()}),t._uU(23,"CLAIM"),t.qZA(),t.qZA(),t.TgZ(24,"div",8),t.TgZ(25,"h2"),t._uU(26,"Inter-Protocol Behaviors"),t.qZA(),t.TgZ(27,"table",9),t.ynx(28,10),t.YNc(29,z,2,0,"th",11),t.YNc(30,F,2,1,"td",12),t.BQk(),t.ynx(31,13),t.YNc(32,j,2,0,"th",14),t.YNc(33,q,3,4,"td",15),t.BQk(),t.ynx(34,16),t.YNc(35,J,2,0,"th",14),t.YNc(36,k,3,4,"td",15),t.BQk(),t.ynx(37,17),t.YNc(38,I,2,0,"th",14),t.YNc(39,X,3,4,"td",15),t.BQk(),t.YNc(40,G,1,0,"tr",18),t.YNc(41,W,1,0,"tr",19),t.qZA(),t.qZA(),t.TgZ(42,"div",8),t.TgZ(43,"h2"),t._uU(44,"Ex-Protocol Behaviors"),t.qZA(),t.TgZ(45,"table",9),t.ynx(46,10),t.YNc(47,K,2,0,"th",11),t.YNc(48,V,2,1,"td",12),t.BQk(),t.ynx(49,13),t.YNc(50,tt,2,0,"th",14),t.YNc(51,et,3,4,"td",15),t.BQk(),t.ynx(52,16),t.YNc(53,nt,2,0,"th",14),t.YNc(54,rt,3,4,"td",15),t.BQk(),t.ynx(55,17),t.YNc(56,it,2,0,"th",14),t.YNc(57,ot,3,4,"td",15),t.BQk(),t.YNc(58,at,1,0,"tr",18),t.YNc(59,st,1,0,"tr",19),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(6),t.hij("",t.xi3(7,10,i.use2earnService.distributedTiTiRewards,2)," TiTi"),t.xp6(7),t.hij("",t.xi3(14,13,i.use2earnService.buyTiUSDPersonalReward+i.use2earnService.holdTiUSDPersonalReward+i.use2earnService.buyTiTiPersonalReward,2)," TiTi"),t.xp6(7),t.hij("",t.xi3(21,16,i.use2earnService.totalClaimableRewards,2)," TiTi"),t.xp6(2),t.Q6J("disabled",0===i.use2earnService.totalClaimableRewards),t.xp6(5),t.Q6J("dataSource",i.dataSource1),t.xp6(13),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(4),t.Q6J("dataSource",i.dataSource2),t.xp6(13),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns))},directives:[L.Q,U.lW,u.BZ,u.w1,u.fO,u.Dz,u.as,u.nj,u.ge,u.ev,u.XQ,u.Gk],pipes:[Q.p],styles:[".mat-row[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{border-bottom:1px solid transparent;border-top:1px solid transparent;cursor:pointer}.mat-row[_ngcontent-%COMP%]:hover   .mat-cell[_ngcontent-%COMP%]{border-color:#1de9b6}.use2earn-wrapper[_ngcontent-%COMP%]{padding:12px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr 1fr;align-items:center;grid-column-gap:24px;column-gap:24px;grid-row-gap:24px;row-gap:24px}.biz-info-card[_ngcontent-%COMP%]{min-height:120px;padding:18px;grid-column-start:span 2;display:grid;grid-template-columns:1fr 1fr 1fr 1fr}.biz-info-card[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{grid-column-start:span 4;margin-left:12px}.biz-info-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{grid-column-start:span 3;align-self:end;font-size:18px;margin-left:12px}.biz-info-card[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{grid-column-start:span 1}.activity-table-wrapper[_ngcontent-%COMP%]{grid-column-start:span 3;padding:12px;display:flex;align-items:center;flex-direction:column;min-height:360px}.activity-table[_ngcontent-%COMP%]{width:100%;background-color:transparent}.activity-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .activity-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:0 4px}.activity-table[_ngcontent-%COMP%]   .left-align[_ngcontent-%COMP%]{text-align:left}.activity-table[_ngcontent-%COMP%]   .right-align[_ngcontent-%COMP%]{text-align:right}@media screen and (max-width: 1024px){.use2earn-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;margin:0;display:grid;grid-template-columns:1fr;grid-row-gap:12px;row-gap:12px;grid-column-gap:0;column-gap:0}.biz-info-card[_ngcontent-%COMP%]{width:100%;margin:0;min-height:80px}.activity-table-wrapper[_ngcontent-%COMP%]{width:100%;margin:0;padding:12px}}"]}),r})()}];let lt=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[T.Bz.forChild(ct)],T.Bz]}),r})();var ut=a(87841);let mt=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[v.ez,lt,u.p0,U.ot,ut.m]]}),r})()}}]);