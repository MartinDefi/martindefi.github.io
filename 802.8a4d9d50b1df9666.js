"use strict";(self.webpackChunkapp_titi_frontend=self.webpackChunkapp_titi_frontend||[]).push([[802],{84802:(N,P,e)=>{e.r(P),e.d(P,{LpminingModule:()=>E});var C=e(69808),w=e(91083),T=e(24102),U=e(98538),u=e.n(U),d=e(28321),k=e(17489),t=e(5e3),V=e(94602),b=e(11730),v=e(68326),x=e(22313),I=e(53405),M=e(74696),q=e(31657),F=e(48966),D=e(92134),f=e(67322),A=e(77531),S=e(47423),L=e(4834),Z=e(26688),O=e(11523),j=e(75303);const y=[{token0:"TiUSD",token1:"UniswapV2Pair"}],R=[{path:"",component:(()=>{class r{constructor(n,i,a,o,h,s,m,g){this.accountService=n,this.web3Service=i,this.graphService=h,this.echartService=s,this.refreshService=m,this.dialog=g,this.pairList=y,this.currentPair=y[0],this.totalStakedLPToken=0,this.LPTokenBalance=0,this.stakedLPTokenBalance=0,this.claimableValue=0,this.decimal0=18,this.decimal1=18,this.stakingInputValue="0.0000",this.withdrawInputValue="0.0000",this.claimInputValue="0.0000",this.rewardRate=0,this.epochNum=0,this.startTime=0,this.periodFinish=0,this.distributedTiTiRewards=0,this.uniswapFund0=0,this.uniswapFund1=0,this.liquidity=0,this.dailyStakedValue=[],this.dailyLiquidity=[],this.titiDailyPrice=[],this.historicalAPY=[],this.tvl=[],this.LPTokenPrice=0,this.option1={},this.option2={},a.addSvgIconLiteral("USDC",o.bypassSecurityTrustHtml(T.WZ)),a.addSvgIconLiteral("TiUSD",o.bypassSecurityTrustHtml(T.Mg)),a.addSvgIconLiteral("TiTi",o.bypassSecurityTrustHtml(T.FZ))}onStakingInputValueChange(n){this.stakingInputValue=(0,d.Y4)(n.target.value),n.target.value=this.stakingInputValue}onWithdrawInputValueChange(n){this.withdrawInputValue=(0,d.Y4)(n.target.value),n.target.value=this.withdrawInputValue}onClaimInputValueChange(n){this.claimInputValue=(0,d.Y4)(n.target.value),n.target.value=this.claimInputValue}isZero(n){return 0===Number.parseFloat(n)}ngOnInit(){this.initData(),this.unregister=this.refreshService.registerFunction(()=>this.initData())}ngOnDestroy(){this.unregister()}initData(){this.fetchTotalStakedLPToken(),this.fetchBalanceOfStakedLPToken(),this.fetchBalanceOfLPToken(),this.fetchClaimable(),Promise.all([this.fetchEpochInfo(),this.fetchUniwapPairDailyData(),this.fetchDailyStakedValue(),this.fetchOptions()]).then(()=>{this.calcHistoricalAPY(),this.fetchLPTokenPrice()}).then(()=>this.buildOption())}getCurrentEpochTiTiRewards(){return(new Date).getTime()>1e3*this.periodFinish?0:this.rewardRate*(1*this.periodFinish-1*this.startTime)/10**18}buildOption(){this.option1.series[0].data=this.dailyLiquidity,this.option2.series[0].data=this.historicalAPY,this.option1=(0,k.cloneDeep)(this.option1),this.option2=(0,k.cloneDeep)(this.option2)}fetchOptions(){return Promise.all([this.echartService.fetchOption("LPMining-Liquidity"),this.echartService.fetchOption("LPMining-APY")]).then(n=>{this.option1=n[0],this.option2=n[1]})}fetchLPTokenPrice(){this.web3Service.invokeContract("MAMMSwapPair","getDepth",[]).then(n=>{this.LPTokenPrice=this.liquidity>0?2*this.uniswapFund0*(n[1]/10**6/(n[0]/10**18))/(this.liquidity*10**18):0})}calcHistoricalAPY(){const n=Array(30).fill(0);for(let i=0;i<30;i++){const a=this.dailyLiquidity[i]>0?2*this.tvl[i].fund0*this.dailyStakedValue[i]/(this.dailyLiquidity[i]*10**18):0;n[i]=a>0?this.titiDailyPrice[i]*this.rewardRate*86400*365/a:0}this.historicalAPY=n.map(i=>100*i)}fetchTotalStakedLPToken(){this.web3Service.invokeContract("LPStakingPool","totalSupply",[]).then(n=>{this.totalStakedLPToken=n[0]/10**this.decimal1})}fetchBalanceOfLPToken(){this.accountService.getCurrentAccountAsyn().then(n=>this.web3Service.invokeContract("UniswapV2Pair","balanceOf",[n]).then(i=>{this.LPTokenBalance=i[0]/10**this.decimal1}))}fetchBalanceOfStakedLPToken(){this.accountService.getCurrentAccountAsyn().then(n=>this.web3Service.invokeContract("LPStakingPool","balanceOf",[n]).then(i=>{this.stakedLPTokenBalance=i[0]/10**this.decimal1}))}fetchClaimable(){this.accountService.getCurrentAccountAsyn().then(n=>this.web3Service.invokeContract("LPStakingPool","earned",[n]).then(i=>{this.claimableValue=i[0]/10**18;const a=Math.pow(10,4);this.claimInputValue=(Math.floor(this.claimableValue*a)/a).toFixed(4)}))}fetchEpochInfo(){return Promise.all([this.web3Service.invokeContract("LPStakingPool","rewardRate",[]),this.web3Service.invokeContract("LPStakingPool","epochNum",[]),this.web3Service.invokeContract("LPStakingPool","startTime",[]),this.web3Service.invokeContract("LPStakingPool","periodFinish",[])]).then(n=>{this.rewardRate=n[0][0],this.epochNum=n[1][0],this.startTime=n[2][0],this.periodFinish=n[3][0];const i=(new Date).getTime()/1e3;this.distributedTiTiRewards=0,this.distributedTiTiRewards+=this.rewardRate*((i>this.periodFinish?this.periodFinish:i)-this.startTime)/10**18}).then(()=>this.fetchHistoricalLPStakingEpoch())}fetchHistoricalLPStakingEpoch(){return this.graphService.fetchHistoricalLPStakingEpoch(this.epochNum).then(({data:n})=>{n.lpstakingEpoches.forEach(i=>this.distributedTiTiRewards+=i.totalReward)})}fetchDailyStakedValue(){return this.graphService.fetchDailyLPTokenStakedValue().then(({data:n})=>{const i=Array(30).fill(null),a=(0,d.Gq)().reverse();n.dailyLPStakings.forEach(h=>{const s=a.indexOf(1e3*h.dayTimestamp);-1!==s&&(i[s]=h.stakedValue)});let o=0;i.forEach((h,s)=>{null==h?i[s]=o:o=h}),this.dailyStakedValue=i})}fetchUniwapPairDailyData(){return this.graphService.fetchUniwapPairDailyData().then(({data:n})=>{this.uniswapFund0=n.uniswapPair.fund0,this.uniswapFund1=n.uniswapPair.fund1,this.liquidity=n.uniswapPair.liquidity/10**18;const i=Array(30).fill(null),a=Array(30).fill(null),o=Array(30).fill(null),h=(0,d.Gq)().reverse();n.uniswapPair.dailyData.forEach(l=>{const p=h.indexOf(1e3*l.dayStartTimestamp);-1!==p&&(i[p]=l.fund1/l.fund0,a[p]={fund0:l.fund0,fund1:l.fund1},o[p]=l.liquidity/10**18)});let s=0,m={fund0:0,fund1:0},g=0;i.forEach((l,p)=>{null==l?i[p]=s:s=l}),a.forEach((l,p)=>{null==l?a[p]=m:m=l}),o.forEach((l,p)=>{null==l?o[p]=g:g=l}),this.titiDailyPrice=i,this.dailyLiquidity=o,this.tvl=a})}onStake(){const n=Math.pow(10,4),i=new(u())((0,d.uM)(this.stakingInputValue)).mul(new(u())("10").pow(new(u())(18))).div(new(u())(n));this.web3Service.openApproveModal(this.currentPair.token1,i,"LPStakingPool",a=>{a&&this.web3Service.invokeContract("LPStakingPool","stake",[i.toString()]).then(o=>{})})}onWithdraw(){const n=Math.pow(10,4),i=new(u())((0,d.uM)(this.withdrawInputValue)).mul(new(u())("10").pow(new(u())(6))).div(new(u())(n));this.web3Service.invokeContract("LPStakingPool","withdraw",[i.toString()]).then(a=>{})}onClaim(){const n=Math.pow(10,4),i=(Math.floor(this.claimableValue*n*10**18)/n).toFixed(0);this.web3Service.invokeContract("LPStakingPool","getReward",[]).then(a=>{e.e(797).then(e.bind(e,51797)).then(({TitiStakingModalComponent:o})=>{this.dialog.open(o).afterClosed().subscribe(s=>{s&&this.web3Service.openApproveModal("TiTiToken",new(u())(i),"TiTiStaking",m=>{m&&this.accountService.getCurrentAccountAsyn().then(g=>this.web3Service.invokeContract("TiTiStaking","stake",[g,new(u())(i).toString()]).then(l=>{}))})})})},a=>{})}onWithdrawAll(){this.web3Service.invokeContract("MarketMakerFund","withdrawAll",[]).then(n=>{})}maxStakeInputValue(){const n=Math.pow(10,4);this.stakingInputValue=(Math.floor(this.LPTokenBalance*n)/n).toFixed(4)}maxWithdrawInputValue(){const n=Math.pow(10,4);this.withdrawInputValue=(Math.floor(this.stakedLPTokenBalance*n)/n).toFixed(4)}maxClaimInputValue(){const n=Math.pow(10,4);this.claimInputValue=(Math.floor(this.claimableValue*n)/n).toFixed(4)}}return r.\u0275fac=function(n){return new(n||r)(t.Y36(V.B),t.Y36(b.Uc),t.Y36(v.jv),t.Y36(x.H7),t.Y36(I.h),t.Y36(M.p),t.Y36(q.g),t.Y36(F.uw))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-lpmining"]],decls:112,vars:52,consts:[[1,"lpmining-wrapper"],[1,"lpmining-card","mat-elevation-z4"],[2,"justify-self","center","grid-column-start","1","grid-column-end","4"],["href","","target","_blank",1,"uniswap-link"],[2,"justify-self","start"],[2,"justify-self","end"],["text","xxxxxxxxxxxxxxxxxxxxx"],["appearance","outline",1,"lpmining-input"],["type","text","matInput","","placeholder","0.0000",2,"font-size","18px",3,"value","input"],["matPrefix",""],["svgIcon","TiUSD",2,"margin-right","-6px","float","left"],["svgIcon","TiTi",2,"margin-right","24px"],["matSuffix","","mat-flat-button","",2,"margin-bottom","12px","background-color","transparent","color","#2DD6B5",3,"click"],["mat-raised-button","","color","primary",1,"lpmining-input-btn",3,"disabled","click"],["type","text","matInput","","disabled","",2,"font-size","18px",3,"value","input"],["matPrefix","","svgIcon","TiTi",2,"padding-right","12px"],[1,"pool-info-card","mat-elevation-z4"],[1,"pool-info-title"],[2,"justify-self","center","grid-column-start","span 2"],[2,"justify-self","start","grid-column-start","span 2"],[2,"justify-self","end","grid-column-start","span 2"],[1,"pool-chart"],[2,"width","100%","height","100%",3,"option"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"h2",2),t._uU(3," TiTi-TiUSD LP Mining "),t.qZA(),t.TgZ(4,"a",3),t._uU(5," Add Liquidity in Uniswap-V2 "),t.qZA(),t.TgZ(6,"h3",4),t._uU(7,"Total Staked Value:"),t.qZA(),t._UZ(8,"div"),t.TgZ(9,"h3",5),t._uU(10),t.ALo(11,"numberFormat"),t.qZA(),t.TgZ(12,"h3",4),t._uU(13,"Your Staked Value:"),t.qZA(),t._UZ(14,"div"),t.TgZ(15,"h3",5),t._uU(16),t.ALo(17,"numberFormat"),t.qZA(),t.TgZ(18,"h3",4),t._uU(19,"Dynamic APY"),t._UZ(20,"titi-tooltip",6),t._uU(21,":"),t.qZA(),t._UZ(22,"div"),t.TgZ(23,"h3",5),t._uU(24),t.ALo(25,"numberFormat"),t.qZA(),t.TgZ(26,"h3",4),t._uU(27,"Claimable Rewards"),t._UZ(28,"titi-tooltip",6),t._uU(29,":"),t.qZA(),t._UZ(30,"div"),t.TgZ(31,"h3",5),t._uU(32),t.ALo(33,"numberFormat"),t.qZA(),t.TgZ(34,"mat-form-field",7),t.TgZ(35,"mat-label"),t._uU(36),t.ALo(37,"numberFormat"),t.qZA(),t.TgZ(38,"input",8),t.NdJ("input",function(o){return i.onStakingInputValueChange(o)}),t.qZA(),t.TgZ(39,"div",9),t._UZ(40,"mat-icon",10),t._UZ(41,"mat-icon",11),t.qZA(),t.TgZ(42,"button",12),t.NdJ("click",function(){return i.maxStakeInputValue()}),t._uU(43,"MAX"),t.qZA(),t.qZA(),t.TgZ(44,"button",13),t.NdJ("click",function(){return i.onStake()}),t._uU(45,"STAKE"),t.qZA(),t.TgZ(46,"mat-form-field",7),t.TgZ(47,"mat-label"),t._uU(48),t.ALo(49,"numberFormat"),t.qZA(),t.TgZ(50,"input",8),t.NdJ("input",function(o){return i.onWithdrawInputValueChange(o)}),t.qZA(),t.TgZ(51,"div",9),t._UZ(52,"mat-icon",10),t._UZ(53,"mat-icon",11),t.qZA(),t.TgZ(54,"button",12),t.NdJ("click",function(){return i.maxWithdrawInputValue()}),t._uU(55,"MAX"),t.qZA(),t.qZA(),t.TgZ(56,"button",13),t.NdJ("click",function(){return i.onWithdraw()}),t._uU(57,"WITHDRAW"),t.qZA(),t.TgZ(58,"mat-form-field",7),t.TgZ(59,"mat-label"),t._uU(60),t.ALo(61,"numberFormat"),t.qZA(),t.TgZ(62,"input",14),t.NdJ("input",function(o){return i.onClaimInputValueChange(o)}),t.qZA(),t._UZ(63,"mat-icon",15),t.TgZ(64,"button",12),t.NdJ("click",function(){return i.maxClaimInputValue()}),t._uU(65,"MAX"),t.qZA(),t.qZA(),t.TgZ(66,"button",13),t.NdJ("click",function(){return i.onClaim()}),t._uU(67,"CLAIM"),t.qZA(),t.qZA(),t.TgZ(68,"div",16),t.TgZ(69,"h2",17),t._uU(70,"USDC Pool Info"),t.qZA(),t._UZ(71,"mat-divider"),t.TgZ(72,"mat-chip-list",18),t.TgZ(73,"mat-chip"),t._uU(74,"Yield"),t.qZA(),t.qZA(),t._UZ(75,"mat-divider"),t.TgZ(76,"span",19),t._uU(77,"Total Liquidity:"),t.qZA(),t.TgZ(78,"span",20),t._uU(79),t.ALo(80,"numberFormat"),t.qZA(),t.TgZ(81,"span",19),t._uU(82,"Staked Ratio:"),t.qZA(),t.TgZ(83,"span",20),t._uU(84),t.ALo(85,"numberFormat"),t.qZA(),t.TgZ(86,"span",19),t._uU(87,"Distributed TiTi Rewards"),t._UZ(88,"titi-tooltip",6),t._uU(89,":"),t.qZA(),t.TgZ(90,"span",20),t._uU(91),t.ALo(92,"numberFormat"),t.qZA(),t.TgZ(93,"span",19),t._uU(94,"Current Epoch TiTi Rewards:"),t.qZA(),t.TgZ(95,"span",20),t._uU(96),t.ALo(97,"numberFormat"),t.qZA(),t._UZ(98,"mat-divider"),t.TgZ(99,"mat-chip-list",18),t.TgZ(100,"mat-chip"),t._uU(101,"Historical Liquidity"),t.qZA(),t.qZA(),t._UZ(102,"mat-divider"),t.TgZ(103,"div",21),t._UZ(104,"titi-chart-wrapper",22),t.qZA(),t._UZ(105,"mat-divider"),t.TgZ(106,"mat-chip-list",18),t.TgZ(107,"mat-chip"),t._uU(108,"Historical APY"),t.qZA(),t.qZA(),t._UZ(109,"mat-divider"),t.TgZ(110,"div",21),t._UZ(111,"titi-chart-wrapper",22),t.qZA(),t.qZA(),t.qZA()),2&n&&(t.xp6(10),t.hij("$",t.xi3(11,19,i.totalStakedLPToken*i.LPTokenPrice,4),""),t.xp6(6),t.hij("$",t.xi3(17,22,i.stakedLPTokenBalance*i.LPTokenPrice,4),""),t.xp6(8),t.hij("",t.xi3(25,25,i.historicalAPY[i.historicalAPY.length-1],4),"%"),t.xp6(8),t.hij("",t.xi3(33,28,i.claimableValue,4)," TiTi"),t.xp6(4),t.hij("Balance:",t.xi3(37,31,i.LPTokenBalance,4)," UNI-V2"),t.xp6(2),t.Q6J("value",i.stakingInputValue),t.xp6(6),t.Q6J("disabled",!i.stakingInputValue||i.isZero(i.stakingInputValue)),t.xp6(4),t.hij("Staked:",t.xi3(49,34,i.stakedLPTokenBalance,4)," UNI-V2"),t.xp6(2),t.Q6J("value",i.withdrawInputValue),t.xp6(6),t.Q6J("disabled",!i.withdrawInputValue||i.isZero(i.withdrawInputValue)),t.xp6(4),t.hij("Claimable:",t.xi3(61,37,i.claimableValue,4)," TiTi"),t.xp6(2),t.Q6J("value",i.claimInputValue),t.xp6(4),t.Q6J("disabled",!i.claimInputValue||i.isZero(i.claimInputValue)),t.xp6(13),t.hij("$",t.xi3(80,40,i.liquidity*i.LPTokenPrice,4),""),t.xp6(5),t.hij("",t.xi3(85,43,100*i.totalStakedLPToken/i.liquidity,4),"%"),t.xp6(7),t.hij("",t.xi3(92,46,i.distributedTiTiRewards,4)," TiTi"),t.xp6(5),t.hij("",t.xi3(97,49,i.getCurrentEpochTiTiRewards(),4)," TiTi"),t.xp6(8),t.Q6J("option",i.option1),t.xp6(7),t.Q6J("option",i.option2))},directives:[D.Q,f.KE,f.hX,A.Nt,f.qo,v.Hw,S.lW,f.R9,L.d,Z.qn,Z.HS,O.o],pipes:[j.p],styles:[".lpmining-wrapper[_ngcontent-%COMP%]{padding:24px;display:grid;grid-template-columns:15fr 9fr 1fr;grid-column-gap:48px;column-gap:48px}.lpmining-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;padding:24px 48px;display:grid;grid-template-columns:1fr 1fr 1fr;grid-row-gap:18px;row-gap:18px;align-items:center}.lpmining-input[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:3}.lpmining-btn[_ngcontent-%COMP%]{grid-column-start:1;grid-column-end:4}.lpmining-input-btn[_ngcontent-%COMP%]{width:80%;justify-self:end;margin-bottom:18px;height:56px}.pool-info-card[_ngcontent-%COMP%]{align-self:start;justify-self:start;width:100%;padding:12px 24px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr;grid-row-gap:24px;row-gap:24px;align-items:center}.pool-info-title[_ngcontent-%COMP%]{grid-column-start:span 4;justify-self:center}.pool-chart[_ngcontent-%COMP%]{grid-column-start:span 4;justify-self:center;width:100%;height:100%}.uniswap-link[_ngcontent-%COMP%]{justify-self:center;grid-column-start:1;grid-column-end:4;color:#29c7a8}@media screen and (max-width: 1024px){.lpmining-wrapper[_ngcontent-%COMP%]{width:100%;padding:12px;margin:0;display:grid;grid-template-columns:1fr;grid-row-gap:12px;row-gap:12px}.lpmining-card[_ngcontent-%COMP%], .pool-info-card[_ngcontent-%COMP%]{width:100%;padding:24px 12px}}"]}),r})()}];let Y=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[w.Bz.forChild(R)],w.Bz]}),r})();var B=e(45922),J=e(87841);let E=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[C.ez,Y,A.c,S.ot,v.Ps,L.t,Z.Hi,B.F,J.m]]}),r})()}}]);